!function e(n,t,r){function i(a,u){if(!t[a]){if(!n[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=t[a]={exports:{}};n[a][0].call(c.exports,function(e){var t=n[a][1][e];return i(t?t:e)},c,c.exports,e,n,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,n,t){(function(e){(function(){function r(e,n,t){for(var r=(t||0)-1,i=e?e.length:0;++r<i;)if(e[r]===n)return r;return-1}function i(e,n){var t=typeof n;if(e=e.cache,"boolean"==t||null==n)return e[n]?0:-1;"number"!=t&&"string"!=t&&(t="object");var i="number"==t?n:b+n;return e=(e=e[t])&&e[i],"object"==t?e&&r(e,n)>-1?0:-1:e?0:-1}function o(e){var n=this.cache,t=typeof e;if("boolean"==t||null==e)n[e]=!0;else{"number"!=t&&"string"!=t&&(t="object");var r="number"==t?e:b+e,i=n[t]||(n[t]={});"object"==t?(i[r]||(i[r]=[])).push(e):i[r]=!0}}function a(e){return e.charCodeAt(0)}function u(e,n){for(var t=e.criteria,r=n.criteria,i=-1,o=t.length;++i<o;){var a=t[i],u=r[i];if(a!==u){if(a>u||"undefined"==typeof a)return 1;if(u>a||"undefined"==typeof u)return-1}}return e.index-n.index}function s(e){var n=-1,t=e.length,r=e[0],i=e[t/2|0],a=e[t-1];if(r&&"object"==typeof r&&i&&"object"==typeof i&&a&&"object"==typeof a)return!1;var u=f();u["false"]=u["null"]=u["true"]=u.undefined=!1;var s=f();for(s.array=e,s.cache=u,s.push=o;++n<t;)s.push(e[n]);return s}function l(e){return"\\"+Q[e]}function c(){return m.pop()||[]}function f(){return y.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function h(e){e.length=0,m.length<S&&m.push(e)}function d(e){var n=e.cache;n&&d(n),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,y.length<S&&y.push(e)}function p(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,i=t-n||0,o=Array(0>i?0:i);++r<i;)o[r]=e[n+r];return o}function g(e){function n(e){return e&&"object"==typeof e&&!Kr(e)&&Pr.call(e,"__wrapped__")?e:new t(e)}function t(e,n){this.__chain__=!!n,this.__wrapped__=e}function o(e){function n(){if(r){var e=p(r);Ar.apply(e,arguments)}if(this instanceof n){var o=y(t.prototype),a=t.apply(o,e||arguments);return Nn(a)?a:o}return t.apply(i,e||arguments)}var t=e[0],r=e[2],i=e[4];return Zr(n,e),n}function m(e,n,t,r,i){if(t){var o=t(e);if("undefined"!=typeof o)return o}var a=Nn(e);if(!a)return e;var u=Rr.call(e);if(!W[u])return e;var s=Xr[u];switch(u){case B:case $:return new s(+e);case H:case G:return new s(e);case V:return o=s(e.source,k.exec(e)),o.lastIndex=e.lastIndex,o}var l=Kr(e);if(n){var f=!r;r||(r=c()),i||(i=c());for(var d=r.length;d--;)if(r[d]==e)return i[d];o=l?s(e.length):{}}else o=l?p(e):oi({},e);return l&&(Pr.call(e,"index")&&(o.index=e.index),Pr.call(e,"input")&&(o.input=e.input)),n?(r.push(e),i.push(o),(l?Zn:si)(e,function(e,a){o[a]=m(e,n,t,r,i)}),f&&(h(r),h(i)),o):o}function y(e){return Nn(e)?$r(e):{}}function S(e,n,t){if("function"!=typeof e)return Kt;if("undefined"==typeof n||!("prototype"in e))return e;var r=e.__bindData__;if("undefined"==typeof r&&(Qr.funcNames&&(r=!e.name),r=r||!Qr.funcDecomp,!r)){var i=Cr.call(e);Qr.funcNames||(r=!O.test(i)),r||(r=j.test(i),Zr(e,r))}if(r===!1||r!==!0&&1&r[1])return e;switch(t){case 1:return function(t){return e.call(n,t)};case 2:return function(t,r){return e.call(n,t,r)};case 3:return function(t,r,i){return e.call(n,t,r,i)};case 4:return function(t,r,i,o){return e.call(n,t,r,i,o)}}return At(e,n)}function Q(e){function n(){var e=s?a:this;if(i){var d=p(i);Ar.apply(d,arguments)}if((o||c)&&(d||(d=p(arguments)),o&&Ar.apply(d,o),c&&d.length<u))return r|=16,Q([t,f?r:-4&r,d,null,a,u]);if(d||(d=arguments),l&&(t=e[h]),this instanceof n){e=y(t.prototype);var g=t.apply(e,d);return Nn(g)?g:e}return t.apply(e,d)}var t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=1&r,l=2&r,c=4&r,f=8&r,h=t;return Zr(n,e),n}function K(e,n){var t=-1,o=ln(),a=e?e.length:0,u=a>=_&&o===r,l=[];if(u){var c=s(n);c?(o=i,n=c):u=!1}for(;++t<a;){var f=e[t];o(n,f)<0&&l.push(f)}return u&&d(n),l}function J(e,n,t,r){for(var i=(r||0)-1,o=e?e.length:0,a=[];++i<o;){var u=e[i];if(u&&"object"==typeof u&&"number"==typeof u.length&&(Kr(u)||dn(u))){n||(u=J(u,n,t));var s=-1,l=u.length,c=a.length;for(a.length+=l;++s<l;)a[c++]=u[s]}else t||a.push(u)}return a}function en(e,n,t,r,i,o){if(t){var a=t(e,n);if("undefined"!=typeof a)return!!a}if(e===n)return 0!==e||1/e==1/n;var u=typeof e,s=typeof n;if(!(e!==e||e&&X[u]||n&&X[s]))return!1;if(null==e||null==n)return e===n;var l=Rr.call(e),f=Rr.call(n);if(l==F&&(l=U),f==F&&(f=U),l!=f)return!1;switch(l){case B:case $:return+e==+n;case H:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case V:case G:return e==Sr(n)}var d=l==M;if(!d){var p=Pr.call(e,"__wrapped__"),g=Pr.call(n,"__wrapped__");if(p||g)return en(p?e.__wrapped__:e,g?n.__wrapped__:n,t,r,i,o);if(l!=U)return!1;var v=e.constructor,m=n.constructor;if(v!=m&&!(Ln(v)&&v instanceof v&&Ln(m)&&m instanceof m)&&"constructor"in e&&"constructor"in n)return!1}var y=!i;i||(i=c()),o||(o=c());for(var x=i.length;x--;)if(i[x]==e)return o[x]==n;var b=0;if(a=!0,i.push(e),o.push(n),d){if(x=e.length,b=n.length,a=b==x,a||r)for(;b--;){var _=x,S=n[b];if(r)for(;_--&&!(a=en(e[_],S,t,r,i,o)););else if(!(a=en(e[b],S,t,r,i,o)))break}}else ui(n,function(n,u,s){return Pr.call(s,u)?(b++,a=Pr.call(e,u)&&en(e[u],n,t,r,i,o)):void 0}),a&&!r&&ui(e,function(e,n,t){return Pr.call(t,n)?a=--b>-1:void 0});return i.pop(),o.pop(),y&&(h(i),h(o)),a}function nn(e,n,t,r,i){(Kr(n)?Zn:si)(n,function(n,o){var a,u,s=n,l=e[o];if(n&&((u=Kr(n))||li(n))){for(var c=r.length;c--;)if(a=r[c]==n){l=i[c];break}if(!a){var f;t&&(s=t(l,n),(f="undefined"!=typeof s)&&(l=s)),f||(l=u?Kr(l)?l:[]:li(l)?l:{}),r.push(n),i.push(l),f||nn(l,n,t,r,i)}}else t&&(s=t(l,n),"undefined"==typeof s&&(s=n)),"undefined"!=typeof s&&(l=s);e[o]=l})}function rn(e,n){return e+Nr(Yr()*(n-e+1))}function on(e,n,t){var o=-1,a=ln(),u=e?e.length:0,l=[],f=!n&&u>=_&&a===r,p=t||f?c():l;if(f){var g=s(p);a=i,p=g}for(;++o<u;){var v=e[o],m=t?t(v,o,e):v;(n?!o||p[p.length-1]!==m:a(p,m)<0)&&((t||f)&&p.push(m),l.push(v))}return f?(h(p.array),d(p)):t&&h(p),l}function an(e){return function(t,r,i){var o={};r=n.createCallback(r,i,3);var a=-1,u=t?t.length:0;if("number"==typeof u)for(;++a<u;){var s=t[a];e(o,s,r(s,a,t),t)}else si(t,function(n,t,i){e(o,n,r(n,t,i),i)});return o}}function un(e,n,t,r,i,a){var u=1&n,s=2&n,l=4&n,c=16&n,f=32&n;if(!s&&!Ln(e))throw new Er;c&&!t.length&&(n&=-17,c=t=!1),f&&!r.length&&(n&=-33,f=r=!1);var h=e&&e.__bindData__;if(h&&h!==!0)return h=p(h),h[2]&&(h[2]=p(h[2])),h[3]&&(h[3]=p(h[3])),!u||1&h[1]||(h[4]=i),!u&&1&h[1]&&(n|=8),!l||4&h[1]||(h[5]=a),c&&Ar.apply(h[2]||(h[2]=[]),t),f&&Mr.apply(h[3]||(h[3]=[]),r),h[1]|=n,un.apply(null,h);var d=1==n||17===n?o:Q;return d([e,n,t,r,i,a])}function sn(e){return ni[e]}function ln(){var e=(e=n.indexOf)===yt?r:e;return e}function cn(e){return"function"==typeof e&&kr.test(e)}function fn(e){var n,t;return e&&Rr.call(e)==U&&(n=e.constructor,!Ln(n)||n instanceof n)?(ui(e,function(e,n){t=n}),"undefined"==typeof t||Pr.call(e,t)):!1}function hn(e){return ti[e]}function dn(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Rr.call(e)==F||!1}function pn(e,n,t,r){return"boolean"!=typeof n&&null!=n&&(r=t,t=n,n=!1),m(e,n,"function"==typeof t&&S(t,r,1))}function gn(e,n,t){return m(e,!0,"function"==typeof n&&S(n,t,1))}function vn(e,n){var t=y(e);return n?oi(t,n):t}function mn(e,t,r){var i;return t=n.createCallback(t,r,3),si(e,function(e,n,r){return t(e,n,r)?(i=n,!1):void 0}),i}function yn(e,t,r){var i;return t=n.createCallback(t,r,3),bn(e,function(e,n,r){return t(e,n,r)?(i=n,!1):void 0}),i}function xn(e,n,t){var r=[];ui(e,function(e,n){r.push(n,e)});var i=r.length;for(n=S(n,t,3);i--&&n(r[i--],r[i],e)!==!1;);return e}function bn(e,n,t){var r=ei(e),i=r.length;for(n=S(n,t,3);i--;){var o=r[i];if(n(e[o],o,e)===!1)break}return e}function _n(e){var n=[];return ui(e,function(e,t){Ln(e)&&n.push(t)}),n.sort()}function Sn(e,n){return e?Pr.call(e,n):!1}function En(e){for(var n=-1,t=ei(e),r=t.length,i={};++n<r;){var o=t[n];i[e[o]]=o}return i}function wn(e){return e===!0||e===!1||e&&"object"==typeof e&&Rr.call(e)==B||!1}function In(e){return e&&"object"==typeof e&&Rr.call(e)==$||!1}function Tn(e){return e&&1===e.nodeType||!1}function Rn(e){var n=!0;if(!e)return n;var t=Rr.call(e),r=e.length;return t==M||t==G||t==F||t==U&&"number"==typeof r&&Ln(e.splice)?!r:(si(e,function(){return n=!1}),n)}function kn(e,n,t,r){return en(e,n,"function"==typeof t&&S(t,r,2))}function On(e){return Hr(e)&&!Ur(parseFloat(e))}function Ln(e){return"function"==typeof e}function Nn(e){return!(!e||!X[typeof e])}function Cn(e){return Pn(e)&&e!=+e}function jn(e){return null===e}function Pn(e){return"number"==typeof e||e&&"object"==typeof e&&Rr.call(e)==H||!1}function An(e){return e&&"object"==typeof e&&Rr.call(e)==V||!1}function Dn(e){return"string"==typeof e||e&&"object"==typeof e&&Rr.call(e)==G||!1}function Fn(e){return"undefined"==typeof e}function Mn(e,t,r){var i={};return t=n.createCallback(t,r,3),si(e,function(e,n,r){i[n]=t(e,n,r)}),i}function Bn(e){var n=arguments,t=2;if(!Nn(e))return e;if("number"!=typeof n[2]&&(t=n.length),t>3&&"function"==typeof n[t-2])var r=S(n[--t-1],n[t--],2);else t>2&&"function"==typeof n[t-1]&&(r=n[--t]);for(var i=p(arguments,1,t),o=-1,a=c(),u=c();++o<t;)nn(e,i[o],r,a,u);return h(a),h(u),e}function $n(e,t,r){var i={};if("function"!=typeof t){var o=[];ui(e,function(e,n){o.push(n)}),o=K(o,J(arguments,!0,!1,1));for(var a=-1,u=o.length;++a<u;){var s=o[a];i[s]=e[s]}}else t=n.createCallback(t,r,3),ui(e,function(e,n,r){t(e,n,r)||(i[n]=e)});return i}function zn(e){for(var n=-1,t=ei(e),r=t.length,i=pr(r);++n<r;){var o=t[n];i[n]=[o,e[o]]}return i}function Hn(e,t,r){var i={};if("function"!=typeof t)for(var o=-1,a=J(arguments,!0,!1,1),u=Nn(e)?a.length:0;++o<u;){var s=a[o];s in e&&(i[s]=e[s])}else t=n.createCallback(t,r,3),ui(e,function(e,n,r){t(e,n,r)&&(i[n]=e)});return i}function Un(e,t,r,i){var o=Kr(e);if(null==r)if(o)r=[];else{var a=e&&e.constructor,u=a&&a.prototype;r=y(u)}return t&&(t=n.createCallback(t,i,4),(o?Zn:si)(e,function(e,n,i){return t(r,e,n,i)})),r}function Vn(e){for(var n=-1,t=ei(e),r=t.length,i=pr(r);++n<r;)i[n]=e[t[n]];return i}function Gn(e){for(var n=arguments,t=-1,r=J(n,!0,!1,1),i=n[2]&&n[2][n[1]]===e?1:r.length,o=pr(i);++t<i;)o[t]=e[r[t]];return o}function Wn(e,n,t){var r=-1,i=ln(),o=e?e.length:0,a=!1;return t=(0>t?Gr(0,o+t):t)||0,Kr(e)?a=i(e,n,t)>-1:"number"==typeof o?a=(Dn(e)?e.indexOf(n,t):i(e,n,t))>-1:si(e,function(e){return++r>=t?!(a=e===n):void 0}),a}function qn(e,t,r){var i=!0;t=n.createCallback(t,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&(i=!!t(e[o],o,e)););else si(e,function(e,n,r){return i=!!t(e,n,r)});return i}function Yn(e,t,r){var i=[];t=n.createCallback(t,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a;){var u=e[o];t(u,o,e)&&i.push(u)}else si(e,function(e,n,r){t(e,n,r)&&i.push(e)});return i}function Xn(e,t,r){t=n.createCallback(t,r,3);var i=-1,o=e?e.length:0;if("number"!=typeof o){var a;return si(e,function(e,n,r){return t(e,n,r)?(a=e,!1):void 0}),a}for(;++i<o;){var u=e[i];if(t(u,i,e))return u}}function Qn(e,t,r){var i;return t=n.createCallback(t,r,3),Kn(e,function(e,n,r){return t(e,n,r)?(i=e,!1):void 0}),i}function Zn(e,n,t){var r=-1,i=e?e.length:0;if(n=n&&"undefined"==typeof t?n:S(n,t,3),"number"==typeof i)for(;++r<i&&n(e[r],r,e)!==!1;);else si(e,n);return e}function Kn(e,n,t){var r=e?e.length:0;if(n=n&&"undefined"==typeof t?n:S(n,t,3),"number"==typeof r)for(;r--&&n(e[r],r,e)!==!1;);else{var i=ei(e);r=i.length,si(e,function(e,t,o){return t=i?i[--r]:--r,n(o[t],t,o)})}return e}function Jn(e,n){var t=p(arguments,2),r=-1,i="function"==typeof n,o=e?e.length:0,a=pr("number"==typeof o?o:0);return Zn(e,function(e){a[++r]=(i?n:e[n]).apply(e,t)}),a}function et(e,t,r){var i=-1,o=e?e.length:0;if(t=n.createCallback(t,r,3),"number"==typeof o)for(var a=pr(o);++i<o;)a[i]=t(e[i],i,e);else a=[],si(e,function(e,n,r){a[++i]=t(e,n,r)});return a}function nt(e,t,r){var i=-1/0,o=i;if("function"!=typeof t&&r&&r[t]===e&&(t=null),null==t&&Kr(e))for(var u=-1,s=e.length;++u<s;){var l=e[u];l>o&&(o=l)}else t=null==t&&Dn(e)?a:n.createCallback(t,r,3),Zn(e,function(e,n,r){var a=t(e,n,r);a>i&&(i=a,o=e)});return o}function tt(e,t,r){var i=1/0,o=i;if("function"!=typeof t&&r&&r[t]===e&&(t=null),null==t&&Kr(e))for(var u=-1,s=e.length;++u<s;){var l=e[u];o>l&&(o=l)}else t=null==t&&Dn(e)?a:n.createCallback(t,r,3),Zn(e,function(e,n,r){var a=t(e,n,r);i>a&&(i=a,o=e)});return o}function rt(e,t,r,i){if(!e)return r;var o=arguments.length<3;t=n.createCallback(t,i,4);var a=-1,u=e.length;if("number"==typeof u)for(o&&(r=e[++a]);++a<u;)r=t(r,e[a],a,e);else si(e,function(e,n,i){r=o?(o=!1,e):t(r,e,n,i)});return r}function it(e,t,r,i){var o=arguments.length<3;return t=n.createCallback(t,i,4),Kn(e,function(e,n,i){r=o?(o=!1,e):t(r,e,n,i)}),r}function ot(e,t,r){return t=n.createCallback(t,r,3),Yn(e,function(e,n,r){return!t(e,n,r)})}function at(e,n,t){if(e&&"number"!=typeof e.length&&(e=Vn(e)),null==n||t)return e?e[rn(0,e.length-1)]:v;var r=ut(e);return r.length=Wr(Gr(0,n),r.length),r}function ut(e){var n=-1,t=e?e.length:0,r=pr("number"==typeof t?t:0);return Zn(e,function(e){var t=rn(0,++n);r[n]=r[t],r[t]=e}),r}function st(e){var n=e?e.length:0;return"number"==typeof n?n:ei(e).length}function lt(e,t,r){var i;t=n.createCallback(t,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&!(i=t(e[o],o,e)););else si(e,function(e,n,r){return!(i=t(e,n,r))});return!!i}function ct(e,t,r){var i=-1,o=Kr(t),a=e?e.length:0,s=pr("number"==typeof a?a:0);for(o||(t=n.createCallback(t,r,3)),Zn(e,function(e,n,r){var a=s[++i]=f();o?a.criteria=et(t,function(n){return e[n]}):(a.criteria=c())[0]=t(e,n,r),a.index=i,a.value=e}),a=s.length,s.sort(u);a--;){var l=s[a];s[a]=l.value,o||h(l.criteria),d(l)}return s}function ft(e){return e&&"number"==typeof e.length?p(e):Vn(e)}function ht(e){for(var n=-1,t=e?e.length:0,r=[];++n<t;){var i=e[n];i&&r.push(i)}return r}function dt(e){return K(e,J(arguments,!0,!0,1))}function pt(e,t,r){var i=-1,o=e?e.length:0;for(t=n.createCallback(t,r,3);++i<o;)if(t(e[i],i,e))return i;return-1}function gt(e,t,r){var i=e?e.length:0;for(t=n.createCallback(t,r,3);i--;)if(t(e[i],i,e))return i;return-1}function vt(e,t,r){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var a=-1;for(t=n.createCallback(t,r,3);++a<o&&t(e[a],a,e);)i++}else if(i=t,null==i||r)return e?e[0]:v;return p(e,0,Wr(Gr(0,i),o))}function mt(e,n,t,r){return"boolean"!=typeof n&&null!=n&&(r=t,t="function"!=typeof n&&r&&r[n]===e?null:n,n=!1),null!=t&&(e=et(e,t,r)),J(e,n)}function yt(e,n,t){if("number"==typeof t){var i=e?e.length:0;t=0>t?Gr(0,i+t):t||0}else if(t){var o=Rt(e,n);return e[o]===n?o:-1}return r(e,n,t)}function xt(e,t,r){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var a=o;for(t=n.createCallback(t,r,3);a--&&t(e[a],a,e);)i++}else i=null==t||r?1:t||i;return p(e,0,Wr(Gr(0,o-i),o))}function bt(){for(var e=[],n=-1,t=arguments.length,o=c(),a=ln(),u=a===r,l=c();++n<t;){var f=arguments[n];(Kr(f)||dn(f))&&(e.push(f),o.push(u&&f.length>=_&&s(n?e[n]:l)))}var p=e[0],g=-1,v=p?p.length:0,m=[];e:for(;++g<v;){var y=o[0];if(f=p[g],(y?i(y,f):a(l,f))<0){for(n=t,(y||l).push(f);--n;)if(y=o[n],(y?i(y,f):a(e[n],f))<0)continue e;m.push(f)}}for(;t--;)y=o[t],y&&d(y);return h(o),h(l),m}function _t(e,t,r){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var a=o;for(t=n.createCallback(t,r,3);a--&&t(e[a],a,e);)i++}else if(i=t,null==i||r)return e?e[o-1]:v;return p(e,Gr(0,o-i))}function St(e,n,t){var r=e?e.length:0;for("number"==typeof t&&(r=(0>t?Gr(0,r+t):Wr(t,r-1))+1);r--;)if(e[r]===n)return r;return-1}function Et(e){for(var n=arguments,t=0,r=n.length,i=e?e.length:0;++t<r;)for(var o=-1,a=n[t];++o<i;)e[o]===a&&(Fr.call(e,o--,1),i--);return e}function wt(e,n,t){e=+e||0,t="number"==typeof t?t:+t||1,null==n&&(n=e,e=0);for(var r=-1,i=Gr(0,Or((n-e)/(t||1))),o=pr(i);++r<i;)o[r]=e,e+=t;return o}function It(e,t,r){var i=-1,o=e?e.length:0,a=[];for(t=n.createCallback(t,r,3);++i<o;){var u=e[i];t(u,i,e)&&(a.push(u),Fr.call(e,i--,1),o--)}return a}function Tt(e,t,r){if("number"!=typeof t&&null!=t){var i=0,o=-1,a=e?e.length:0;for(t=n.createCallback(t,r,3);++o<a&&t(e[o],o,e);)i++}else i=null==t||r?1:Gr(0,t);return p(e,i)}function Rt(e,t,r,i){var o=0,a=e?e.length:o;for(r=r?n.createCallback(r,i,1):Kt,t=r(t);a>o;){var u=o+a>>>1;r(e[u])<t?o=u+1:a=u}return o}function kt(){return on(J(arguments,!0,!0))}function Ot(e,t,r,i){return"boolean"!=typeof t&&null!=t&&(i=r,r="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=r&&(r=n.createCallback(r,i,3)),on(e,t,r)}function Lt(e){return K(e,p(arguments,1))}function Nt(){for(var e=-1,n=arguments.length;++e<n;){var t=arguments[e];if(Kr(t)||dn(t))var r=r?on(K(r,t).concat(K(t,r))):t}return r||[]}function Ct(){for(var e=arguments.length>1?arguments:arguments[0],n=-1,t=e?nt(di(e,"length")):0,r=pr(0>t?0:t);++n<t;)r[n]=di(e,n);return r}function jt(e,n){var t=-1,r=e?e.length:0,i={};for(n||!r||Kr(e[0])||(n=[]);++t<r;){var o=e[t];n?i[o]=n[t]:o&&(i[o[0]]=o[1])}return i}function Pt(e,n){if(!Ln(n))throw new Er;return function(){return--e<1?n.apply(this,arguments):void 0}}function At(e,n){return arguments.length>2?un(e,17,p(arguments,2),null,n):un(e,1,null,null,n)}function Dt(e){for(var n=arguments.length>1?J(arguments,!0,!1,1):_n(e),t=-1,r=n.length;++t<r;){var i=n[t];e[i]=un(e[i],1,null,null,e)}return e}function Ft(e,n){return arguments.length>2?un(n,19,p(arguments,2),null,e):un(n,3,null,null,e)}function Mt(){for(var e=arguments,n=e.length;n--;)if(!Ln(e[n]))throw new Er;return function(){for(var n=arguments,t=e.length;t--;)n=[e[t].apply(this,n)];return n[0]}}function Bt(e,n){return n="number"==typeof n?n:+n||e.length,un(e,4,null,null,null,n)}function $t(e,n,t){var r,i,o,a,u,s,l,c=0,f=!1,h=!0;if(!Ln(e))throw new Er;if(n=Gr(0,n)||0,t===!0){var d=!0;h=!1}else Nn(t)&&(d=t.leading,f="maxWait"in t&&(Gr(n,t.maxWait)||0),h="trailing"in t?t.trailing:h);var p=function(){var t=n-(gi()-a);if(0>=t){i&&Lr(i);var f=l;i=s=l=v,f&&(c=gi(),o=e.apply(u,r),s||i||(r=u=null))}else s=Dr(p,t)},g=function(){s&&Lr(s),i=s=l=v,(h||f!==n)&&(c=gi(),o=e.apply(u,r),s||i||(r=u=null))};return function(){if(r=arguments,a=gi(),u=this,l=h&&(s||!d),f===!1)var t=d&&!s;else{i||d||(c=a);var v=f-(a-c),m=0>=v;m?(i&&(i=Lr(i)),c=a,o=e.apply(u,r)):i||(i=Dr(g,v))}return m&&s?s=Lr(s):s||n===f||(s=Dr(p,n)),t&&(m=!0,o=e.apply(u,r)),!m||s||i||(r=u=null),o}}function zt(e){if(!Ln(e))throw new Er;var n=p(arguments,1);return Dr(function(){e.apply(v,n)},1)}function Ht(e,n){if(!Ln(e))throw new Er;var t=p(arguments,2);return Dr(function(){e.apply(v,t)},n)}function Ut(e,n){if(!Ln(e))throw new Er;var t=function(){var r=t.cache,i=n?n.apply(this,arguments):b+arguments[0];return Pr.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};return t.cache={},t}function Vt(e){var n,t;if(!Ln(e))throw new Er;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}}function Gt(e){return un(e,16,p(arguments,1))}function Wt(e){return un(e,32,null,p(arguments,1))}function qt(e,n,t){var r=!0,i=!0;if(!Ln(e))throw new Er;return t===!1?r=!1:Nn(t)&&(r="leading"in t?t.leading:r,i="trailing"in t?t.trailing:i),q.leading=r,q.maxWait=n,q.trailing=i,$t(e,n,q)}function Yt(e,n){return un(n,16,[e])}function Xt(e){return function(){return e}}function Qt(e,n,t){var r=typeof e;if(null==e||"function"==r)return S(e,n,t);if("object"!=r)return tr(e);var i=ei(e),o=i[0],a=e[o];return 1!=i.length||a!==a||Nn(a)?function(n){for(var t=i.length,r=!1;t--&&(r=en(n[i[t]],e[i[t]],null,!0)););return r}:function(e){var n=e[o];return a===n&&(0!==a||1/a==1/n)}}function Zt(e){return null==e?"":Sr(e).replace(ii,sn)}function Kt(e){return e}function Jt(e,r,i){var o=!0,a=r&&_n(r);r&&(i||a.length)||(null==i&&(i=r),u=t,r=e,e=n,a=_n(r)),i===!1?o=!1:Nn(i)&&"chain"in i&&(o=i.chain);var u=e,s=Ln(u);Zn(a,function(n){var t=e[n]=r[n];s&&(u.prototype[n]=function(){var n=this.__chain__,r=this.__wrapped__,i=[r];Ar.apply(i,arguments);var a=t.apply(e,i);if(o||n){if(r===a&&Nn(a))return this;a=new u(a),a.__chain__=n}return a})})}function er(){return e._=Tr,this}function nr(){}function tr(e){return function(n){return n[e]}}function rr(e,n,t){var r=null==e,i=null==n;if(null==t&&("boolean"==typeof e&&i?(t=e,e=1):i||"boolean"!=typeof n||(t=n,i=!0)),r&&i&&(n=1),e=+e||0,i?(n=e,e=0):n=+n||0,t||e%1||n%1){var o=Yr();return Wr(e+o*(n-e+parseFloat("1e-"+((o+"").length-1))),n)}return rn(e,n)}function ir(e,n){if(e){var t=e[n];return Ln(t)?e[n]():t}}function or(e,t,r){var i=n.templateSettings;e=Sr(e||""),r=ai({},r,i);var o,a=ai({},r.imports,i.imports),u=ei(a),s=Vn(a),c=0,f=r.interpolate||C,h="__p += '",d=_r((r.escape||C).source+"|"+f.source+"|"+(f===L?R:C).source+"|"+(r.evaluate||C).source+"|$","g");e.replace(d,function(n,t,r,i,a,u){return r||(r=i),h+=e.slice(c,u).replace(P,l),t&&(h+="' +\n__e("+t+") +\n'"),a&&(o=!0,h+="';\n"+a+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+n.length,n}),h+="';\n";var p=r.variable,g=p;g||(p="obj",h="with ("+p+") {\n"+h+"\n}\n"),h=(o?h.replace(w,""):h).replace(I,"$1").replace(T,"$1;"),h="function("+p+") {\n"+(g?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m="\n/*\n//# sourceURL="+(r.sourceURL||"/lodash/template/source["+D++ +"]")+"\n*/";try{var y=mr(u,"return "+h+m).apply(v,s)}catch(x){throw x.source=h,x}return t?y(t):(y.source=h,y)}function ar(e,n,t){e=(e=+e)>-1?e:0;var r=-1,i=pr(e);for(n=S(n,t,1);++r<e;)i[r]=n(r);return i}function ur(e){return null==e?"":Sr(e).replace(ri,hn)}function sr(e){var n=++x;return Sr(null==e?"":e)+n}function lr(e){return e=new t(e),e.__chain__=!0,e}function cr(e,n){return n(e),e}function fr(){return this.__chain__=!0,this}function hr(){return Sr(this.__wrapped__)}function dr(){return this.__wrapped__}e=e?tn.defaults(Z.Object(),e,tn.pick(Z,A)):Z;var pr=e.Array,gr=e.Boolean,vr=e.Date,mr=e.Function,yr=e.Math,xr=e.Number,br=e.Object,_r=e.RegExp,Sr=e.String,Er=e.TypeError,wr=[],Ir=br.prototype,Tr=e._,Rr=Ir.toString,kr=_r("^"+Sr(Rr).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Or=yr.ceil,Lr=e.clearTimeout,Nr=yr.floor,Cr=mr.prototype.toString,jr=cn(jr=br.getPrototypeOf)&&jr,Pr=Ir.hasOwnProperty,Ar=wr.push,Dr=e.setTimeout,Fr=wr.splice,Mr=wr.unshift,Br=function(){try{var e={},n=cn(n=br.defineProperty)&&n,t=n(e,e,e)&&n}catch(r){}return t}(),$r=cn($r=br.create)&&$r,zr=cn(zr=pr.isArray)&&zr,Hr=e.isFinite,Ur=e.isNaN,Vr=cn(Vr=br.keys)&&Vr,Gr=yr.max,Wr=yr.min,qr=e.parseInt,Yr=yr.random,Xr={};Xr[M]=pr,Xr[B]=gr,Xr[$]=vr,Xr[z]=mr,Xr[U]=br,Xr[H]=xr,Xr[V]=_r,Xr[G]=Sr,t.prototype=n.prototype;var Qr=n.support={};Qr.funcDecomp=!cn(e.WinRTError)&&j.test(g),Qr.funcNames="string"==typeof mr.name,n.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:L,variable:"",imports:{_:n}},$r||(y=function(){function n(){}return function(t){if(Nn(t)){n.prototype=t;var r=new n;n.prototype=null}return r||e.Object()}}());var Zr=Br?function(e,n){Y.value=n,Br(e,"__bindData__",Y)}:nr,Kr=zr||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Rr.call(e)==M||!1},Jr=function(e){var n,t=e,r=[];if(!t)return r;if(!X[typeof e])return r;for(n in t)Pr.call(t,n)&&r.push(n);return r},ei=Vr?function(e){return Nn(e)?Vr(e):[]}:Jr,ni={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ti=En(ni),ri=_r("("+ei(ti).join("|")+")","g"),ii=_r("["+ei(ni).join("")+"]","g"),oi=function(e,n,t){var r,i=e,o=i;if(!i)return o;var a=arguments,u=0,s="number"==typeof t?2:a.length;if(s>3&&"function"==typeof a[s-2])var l=S(a[--s-1],a[s--],2);else s>2&&"function"==typeof a[s-1]&&(l=a[--s]);for(;++u<s;)if(i=a[u],i&&X[typeof i])for(var c=-1,f=X[typeof i]&&ei(i),h=f?f.length:0;++c<h;)r=f[c],o[r]=l?l(o[r],i[r]):i[r];return o},ai=function(e,n,t){var r,i=e,o=i;if(!i)return o;for(var a=arguments,u=0,s="number"==typeof t?2:a.length;++u<s;)if(i=a[u],i&&X[typeof i])for(var l=-1,c=X[typeof i]&&ei(i),f=c?c.length:0;++l<f;)r=c[l],"undefined"==typeof o[r]&&(o[r]=i[r]);return o},ui=function(e,n,t){var r,i=e,o=i;if(!i)return o;if(!X[typeof i])return o;n=n&&"undefined"==typeof t?n:S(n,t,3);for(r in i)if(n(i[r],r,e)===!1)return o;return o},si=function(e,n,t){var r,i=e,o=i;if(!i)return o;if(!X[typeof i])return o;n=n&&"undefined"==typeof t?n:S(n,t,3);for(var a=-1,u=X[typeof i]&&ei(i),s=u?u.length:0;++a<s;)if(r=u[a],n(i[r],r,e)===!1)return o;return o},li=jr?function(e){if(!e||Rr.call(e)!=U)return!1;var n=e.valueOf,t=cn(n)&&(t=jr(n))&&jr(t);return t?e==t||jr(e)==t:fn(e)}:fn,ci=an(function(e,n,t){Pr.call(e,t)?e[t]++:e[t]=1}),fi=an(function(e,n,t){(Pr.call(e,t)?e[t]:e[t]=[]).push(n)}),hi=an(function(e,n,t){e[t]=n}),di=et,pi=Yn,gi=cn(gi=vr.now)&&gi||function(){return(new vr).getTime()},vi=8==qr(E+"08")?qr:function(e,n){return qr(Dn(e)?e.replace(N,""):e,n||0)};return n.after=Pt,n.assign=oi,n.at=Gn,n.bind=At,n.bindAll=Dt,n.bindKey=Ft,n.chain=lr,n.compact=ht,n.compose=Mt,n.constant=Xt,n.countBy=ci,n.create=vn,n.createCallback=Qt,n.curry=Bt,n.debounce=$t,n.defaults=ai,n.defer=zt,n.delay=Ht,n.difference=dt,n.filter=Yn,n.flatten=mt,n.forEach=Zn,n.forEachRight=Kn,n.forIn=ui,n.forInRight=xn,n.forOwn=si,n.forOwnRight=bn,n.functions=_n,n.groupBy=fi,n.indexBy=hi,n.initial=xt,n.intersection=bt,n.invert=En,n.invoke=Jn,n.keys=ei,n.map=et,n.mapValues=Mn,n.max=nt,n.memoize=Ut,n.merge=Bn,n.min=tt,n.omit=$n,n.once=Vt,n.pairs=zn,n.partial=Gt,n.partialRight=Wt,n.pick=Hn,n.pluck=di,n.property=tr,n.pull=Et,n.range=wt,n.reject=ot,n.remove=It,n.rest=Tt,n.shuffle=ut,n.sortBy=ct,n.tap=cr,n.throttle=qt,n.times=ar,n.toArray=ft,n.transform=Un,n.union=kt,n.uniq=Ot,n.values=Vn,n.where=pi,n.without=Lt,n.wrap=Yt,n.xor=Nt,n.zip=Ct,n.zipObject=jt,n.collect=et,n.drop=Tt,n.each=Zn,n.eachRight=Kn,n.extend=oi,n.methods=_n,n.object=jt,n.select=Yn,n.tail=Tt,n.unique=Ot,n.unzip=Ct,Jt(n),n.clone=pn,n.cloneDeep=gn,n.contains=Wn,n.escape=Zt,n.every=qn,n.find=Xn,n.findIndex=pt,n.findKey=mn,n.findLast=Qn,n.findLastIndex=gt,n.findLastKey=yn,n.has=Sn,n.identity=Kt,n.indexOf=yt,n.isArguments=dn,n.isArray=Kr,n.isBoolean=wn,n.isDate=In,n.isElement=Tn,n.isEmpty=Rn,n.isEqual=kn,n.isFinite=On,n.isFunction=Ln,n.isNaN=Cn,n.isNull=jn,n.isNumber=Pn,n.isObject=Nn,n.isPlainObject=li,n.isRegExp=An,n.isString=Dn,n.isUndefined=Fn,n.lastIndexOf=St,n.mixin=Jt,n.noConflict=er,n.noop=nr,n.now=gi,n.parseInt=vi,n.random=rr,n.reduce=rt,n.reduceRight=it,n.result=ir,n.runInContext=g,n.size=st,n.some=lt,n.sortedIndex=Rt,n.template=or,n.unescape=ur,n.uniqueId=sr,n.all=qn,n.any=lt,n.detect=Xn,n.findWhere=Xn,n.foldl=rt,n.foldr=it,n.include=Wn,n.inject=rt,Jt(function(){var e={};return si(n,function(t,r){n.prototype[r]||(e[r]=t)}),e}(),!1),n.first=vt,n.last=_t,n.sample=at,n.take=vt,n.head=vt,si(n,function(e,r){var i="sample"!==r;n.prototype[r]||(n.prototype[r]=function(n,r){var o=this.__chain__,a=e(this.__wrapped__,n,r);return o||null!=n&&(!r||i&&"function"==typeof n)?new t(a,o):a})}),n.VERSION="2.4.1",n.prototype.chain=fr,n.prototype.toString=hr,n.prototype.value=dr,n.prototype.valueOf=dr,Zn(["join","pop","shift"],function(e){var r=wr[e];n.prototype[e]=function(){var e=this.__chain__,n=r.apply(this.__wrapped__,arguments);return e?new t(n,e):n}}),Zn(["push","reverse","sort","unshift"],function(e){var t=wr[e];n.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Zn(["concat","slice","splice"],function(e){var r=wr[e];n.prototype[e]=function(){return new t(r.apply(this.__wrapped__,arguments),this.__chain__)}}),n}var v,m=[],y=[],x=0,b=+new Date+"",_=75,S=40,E=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",w=/\b__p \+= '';/g,I=/\b(__p \+=) '' \+/g,T=/(__e\(.*?\)|\b__t\)) \+\n'';/g,R=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,k=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,L=/<%=([\s\S]+?)%>/g,N=RegExp("^["+E+"]*0+(?=.$)"),C=/($^)/,j=/\bthis\b/,P=/['\n\r\t\u2028\u2029\\]/g,A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],D=0,F="[object Arguments]",M="[object Array]",B="[object Boolean]",$="[object Date]",z="[object Function]",H="[object Number]",U="[object Object]",V="[object RegExp]",G="[object String]",W={};W[z]=!1,W[F]=W[M]=W[B]=W[$]=W[H]=W[U]=W[V]=W[G]=!0;var q={leading:!1,maxWait:0,trailing:!1},Y={configurable:!1,enumerable:!1,value:null,writable:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Q={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Z=X[typeof window]&&window||this,K=X[typeof t]&&t&&!t.nodeType&&t,J=X[typeof n]&&n&&!n.nodeType&&n,en=J&&J.exports===K&&K,nn=X[typeof e]&&e;!nn||nn.global!==nn&&nn.window!==nn||(Z=nn);var tn=g();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Z._=tn,define(function(){return tn})):K&&J?en?(J.exports=tn)._=tn:K._=tn:Z._=tn}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n,t){"use strict";t.intFromBoolean=function(e){return e?1:0},t.booleanFromInt=function(e){return null===e?!1:e>0}},{}],3:[function(e,n){"use strict";var t=e("../janicek/core"),r=t.def,i=function(e,n,o,a,u,s){var l={a:r(e,1),b:r(n,0),c:r(o,0),d:r(a,1),tx:r(u,0),ty:r(s,0),clone:function(){return i(l.a,l.b,l.c,l.d,l.tx,l.ty)},createGradientBox:function(e,n,r,i,o){if(l.a=e/1638.4,l.d=n/1638.4,t.isUndefinedOrNull(r)||0===r)l.b=l.c=0;else{var a=Math.cos(r),u=Math.sin(r);l.b=u*l.d,l.c=-u*l.a,l.a*=a,l.d*=a}l.tx=t.isUndefinedOrNull(i)?e/2:i+e/2,l.ty=t.isUndefinedOrNull(o)?n/2:o+n/2},setRotation:function(e,n){var r=t.isUndefinedOrNull(n)?1:n;l.a=Math.cos(e)*r,l.c=Math.sin(e)*r,l.b=-l.c,l.d=l.a},invert:function(){var e=l.a*l.d-l.b*l.c;if(0===e)l.a=l.b=l.c=l.d=0,l.tx=-l.tx,l.ty=-l.ty;else{e=1/e;var n=l.d*e;l.d=l.a*e,l.a=n,l.b*=-e,l.c*=-e;var t=-l.a*l.tx-l.c*l.ty;l.ty=-l.b*l.tx-l.d*l.ty,l.tx=t}return this},transformPoint:function(e){return{x:e.x*l.a+e.y*l.c+l.tx,y:e.x*l.b+e.y*l.d+l.ty}},translate:function(e,n){l.tx+=e,l.ty+=n},rotate:function(e){var n=Math.cos(e),t=Math.sin(e),r=l.a*n-l.b*t;l.b=l.a*t+l.b*n,l.a=r;var i=l.c*n-l.d*t;l.d=l.c*t+l.d*n,l.c=i;var o=l.tx*n-l.ty*t;l.ty=l.tx*t+l.ty*n,l.tx=o},scale:function(e,n){l.a*=e,l.b*=n,l.c*=e,l.d*=n,l.tx*=e,l.ty*=n},concat:function(e){var n=l.a*e.a+l.b*e.c;l.b=l.a*e.b+l.b*e.d,l.a=n;var t=l.c*e.a+l.d*e.c;l.d=l.c*e.b+l.d*e.d,l.c=t;var r=l.tx*e.a+l.ty*e.c+e.tx;l.ty=l.tx*e.b+l.ty*e.d+e.ty,l.tx=r},mult:function(e){var n=i();return n.a=l.a*e.a+l.b*e.c,n.b=l.a*e.b+l.b*e.d,n.c=l.c*e.a+l.d*e.c,n.d=l.c*e.b+l.d*e.d,n.tx=l.tx*e.a+l.ty*e.c+e.tx,n.ty=l.tx*e.b+l.ty*e.d+e.ty,n},identity:function(){l.a=1,l.b=0,l.c=0,l.d=1,l.tx=0,l.ty=0},toMozString:function(){var e="matrix(";return e+=l.a+", ",e+=l.b+", ",e+=l.c+", ",e+=l.d+", ",e+=l.tx+"px, ",e+=l.ty+"px)"},toString:function(){var e="matrix(";return e+=l.a+", ",e+=l.b+", ",e+=l.c+", ",e+=l.d+", ",e+=l.tx+", ",e+=l.ty+")"}};return l};n.exports=i},{"../janicek/core":11}],4:[function(e,n){"use strict";n.exports={distanceFromOrigin:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},distance:function(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))},interpolate:function(e,n,t){return{x:(e.x-n.x)*t+n.x,y:(e.y-n.y)*t+n.y}},normalize:function(e,n){if(0===e.x&&0===e.y)e.x=n;else{var t=n/Math.sqrt(e.x*e.x+e.y*e.y);e.x*=t,e.y*=t}},add:function(e,n){return{x:n.x+e.x,y:n.y+e.y}},subtract:function(e,n){return{x:e.x-n.x,y:e.y-n.y}},hash:function(e){return e.x+","+e.y}}},{}],5:[function(e,n){"use strict";n.exports=function(e,n,t,r){return{x:e||0,y:n||0,width:t||0,height:r||0}},n.exports.core=function(e){return{left:function(){return e.x},right:function(){return e.x+e.width},top:function(){return e.y},bottom:function(){return e.y+e.height}}}},{}],6:[function(e,n){"use strict";var t=e("../janicek/core").def,r=function(e,n,r,i){this.w=t(i,0),this.x=t(e,0),this.y=t(n,0),this.z=t(r,0)
},i=function(e,n,t,i){return new r(e,n,t,i)};r.prototype={getLength:function(){return Math.abs(i.distance(this,i()))},get length(){return this.getLength()},getLengthSquared:function(){return this.length*this.length},get lengthSquared(){return this.getLengthSquared()},add:function(e){return i(this.x+e.x,this.y+e.y,this.z+e.z)},clone:function(){return i(this.x,this.y,this.z,this.w)},crossProduct:function(e){return i(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x,1)},decrementBy:function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},dotProduct:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},equals:function(e,n){return n=t(n,!1),this.x===e.x&&this.y===e.y&&this.z===e.z&&(!n||this.w===e.w)},incrementBy:function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},nearEquals:function(e,n,r){return r=t(r,!1),Math.abs(this.x-e.x)<n&&Math.abs(this.y-e.y)<n&&Math.abs(this.z-e.z)<n&&(!r||Math.abs(this.w-e.w)<n)},negate:function(){this.x*=-1,this.y*=-1,this.z*=-1},normalize:function(){var e=this.length;return 0!==e&&(this.x/=e,this.y/=e,this.z/=e),e},project:function(){this.x/=this.w,this.y/=this.w,this.z/=this.w},scaleBy:function(e){this.x*=e,this.y*=e,this.z*=e},subtract:function(e){return i(this.x-e.x,this.y-e.y,this.z-e.z)},toString:function(){return"Vector3D("+this.x+", "+this.y+", "+this.z+")"}},i.angleBetween=function(e,n){var t=e.clone();t.normalize();var r=n.clone();return r.normalize(),Math.acos(t.dotProduct(r))},i.distance=function(e,n){var t=n.x-e.x,r=n.y-e.y,i=n.z-e.z;return Math.sqrt(t*t+r*r+i*i)},Object.defineProperties(i,{X_AXIS:{get:function(){return i(1,0,0)}}}),Object.defineProperties(i,{Y_AXIS:{get:function(){return i(0,1,0)}}}),Object.defineProperties(i,{Z_AXIS:{get:function(){return i(0,0,1)}}}),n.exports=i},{"../janicek/core":11}],7:[function(e,n,t){"use strict";function r(){var e=$(m.S_imageThreshold).val(),n=v.style.displayColors.OCEAN,t=v.style.displayColors.GRASSLAND;if($(m.S_invertImage).is(":checked")){var r=n;n=t,t=r}var i=f.makeAverageThresholdImageData(f.getImageData(s),e,n,t),o=f.makeImageDataUrlFromImageData(i);$(m.S_imageThumb).attr("src",o)}function i(e){var n=t.getContext();switch(v.canvasRender.graphicsReset(n,e.map.SIZE.width,e.map.SIZE.height,v.style.displayColors),$(m.S_view).val()){case"debug polygons":v.canvasRender.renderDebugPolygons(n,e.map,v.style.displayColors);break;case"smooth":v.canvasRender.renderPolygons(n,v.style.displayColors,null,v.canvasRender.colorWithSlope,e.map,e.noisyEdges),v.canvasRender.renderEdges(n,v.style.displayColors,e.map,e.noisyEdges,e.lava,$(m.S_viewRivers).is(":checked"))}$(m.S_viewEdges).is(":checked")&&v.canvasRender.renderAllEdges(n,h.rgba(208,208,208,.25),e.map,e.noisyEdges),$(m.S_viewRoads).is(":checked")&&v.canvasRender.renderRoads(n,e.map,e.roads,v.style.displayColors),$(m.S_viewBridges).is(":checked")&&v.canvasRender.renderBridges(n,e.map,e.roads,v.style.displayColors),$(m.S_viewWatersheds).is(":checked")&&v.canvasRender.renderWatersheds(n,e.map,e.watersheds),$(m.S_addNoise).is(":checked")&&f.addNoiseToCanvas(n,666,10,!0)}function o(){var e=document.getElementById(m.ID_map);return null===e&&(e=document.createElement("canvas"),e.id=m.ID_map,document.body.appendChild(e)),e}function a(e){return c(e).isNumber()?c(e).parseInt():Math.abs(d.stringToSeed(e))}function u(){t.initializeUi(),l=t.generate(),e("./janicek/perf").traceCounters()}var s,l,c=e("lodash"),f=e("./janicek/canvas"),h=e("./janicek/html-color"),d=e("./janicek/pseudo-random-number-generators"),p=e("./janicek/string"),g=e("./janicek/timer")(),v=e("./index"),m={ID_map:"map",S_addNoise:"#addNoise",S_edgeNoise:"#edgeNoise",S_fields:"#fields",S_fieldset:"#fieldset",S_generate:"#generate",S_height:"#height",S_imageFile:"#imageFile",S_imageThreshold:"#imageThreshold",S_imageThumb:"#imageThumb",S_invertImage:"#invertImage",S_islandFactor:"#islandFactor",S_islandShape:"#islandShape",S_lakeThreshold:"#lakeThreshold",S_lloydIterations:"#lloydIterations",S_map:"#map",S_numberOfLands:"#numberOfLands",S_numberOfPoints:"#numberOfPoints",S_oceanRatio:"#oceanRatio",S_random:"#random",S_riverChance:"#riverChance",S_roadElevationThresholds:"#roadElevationThresholds",S_seed:"#seed",S_shapeRandom:"#shapeRandom",S_shapeSeed:"#shapeSeed",S_toggle:"#toggle",S_view:"#view",S_viewBridges:"#viewBridges",S_viewEdges:"#viewEdges",S_viewRivers:"#viewRivers",S_viewRoads:"#viewRoads",S_viewWatersheds:"#viewWatersheds",S_width:"#width"};t.initializeUi=function(){s=new Image,s.onload=function(){$(m.S_imageThumb).attr("src",s.src),r()},s.src="world-map.jpg",$(m.S_random).click(function(){$(m.S_seed).val(String(d.makeRandomSeed()))}),$(m.S_shapeRandom).click(function(){$(m.S_shapeSeed).val(String(d.makeRandomSeed()))}),$(m.S_islandShape).change(function(){switch($([m.S_islandFactor,m.S_oceanRatio,m.S_shapeSeed,m.S_imageFile,m.S_imageThumb,m.S_invertImage,m.S_imageThreshold].toString()).parent().hide(),$(m.S_islandShape).val()){case"bitmap":$([m.S_imageFile,m.S_imageThumb,m.S_invertImage,m.S_imageThreshold].toString()).parent().show();break;case"noise":$(m.S_shapeSeed).parent().show();break;case"perlin":$([m.S_oceanRatio,m.S_shapeSeed].toString()).parent().show();break;case"radial":$([m.S_islandFactor,m.S_shapeSeed].toString()).parent().show()}}),$(m.S_imageFile).change(function(){console.log("file changed");var e=$(m.S_imageFile).get()[0],n=e.files;if(1===n.length){var t=n[0];p(t.type).startsWith("image")&&f.loadFileIntoImage(t,s)}}),$([m.S_invertImage,m.S_imageThreshold].toString()).change(function(){r()}),0===$(m.S_width).val().length&&$(m.S_width).val($(window).width()),0===$(m.S_height).val().length&&$(m.S_height).val($(window).height()),$(m.S_view).change(function(){switch($(m.S_view).val()){case"debug polygons":$(m.S_addNoise).removeAttr("checked");break;case"smooth":$(m.S_addNoise).attr("checked","true")}}),$([m.S_view,m.S_viewRivers,m.S_viewRoads,m.S_viewBridges,m.S_viewWatersheds,m.S_viewEdges,m.S_addNoise].toString()).change(function(){i(l)}),$(m.S_viewRoads).change(function(){$(m.S_roadElevationThresholds).parent().toggle()}),$(m.S_generate).click(function(){l=t.generate()}),$(m.S_toggle).click(function(){var e=$(m.S_fields);e.toggle(500,function(){$(m.S_toggle).text(e.is(":visible")?"hide":"show")})})},t.getContext=function(){var e=document.getElementById(m.ID_map);return e.getContext("2d")},t.generate=function(){g.start();var e={map:null,noisyEdges:null,roads:null,watersheds:null,lava:null},n=o();n.width=c($(m.S_width).val()).parseInt(),n.height=c($(m.S_height).val()).parseInt(),e.map=v.map({width:n.width+0,height:n.height+0});var t=a($(m.S_seed).val()),r=a($(m.S_shapeSeed).val()),u=$(m.S_islandShape).val();switch(u){case"bitmap":var l=f.getImageData(s),h=f.makeAverageThresholdBitmap(l,c.parseInt($(m.S_imageThreshold).val()));$(m.S_invertImage).is(":checked")&&(h=f.invertBitmap(h)),e.map.newIsland(v.islandShape.makeBitmap(h),t);break;case"blob":e.map.newIsland(v.islandShape.makeBlob(),t);break;case"noise":e.map.newIsland(v.islandShape.makeNoise(r),t);break;case"perlin":e.map.newIsland(v.islandShape.makePerlin(r,$(m.S_oceanRatio).val()),t);break;case"radial":e.map.newIsland(v.islandShape.makeRadial(r,$(m.S_islandFactor).val()),t);break;case"square":e.map.newIsland(v.islandShape.makeSquare(),t)}e.watersheds=v.watersheds(),e.noisyEdges=v.noisyEdges(),e.lava=v.lava(),e.roads=v.roads();var d=function(e,n,t,r){switch(e){case"random":return v.pointSelector.generateRandom(n,t,r);case"relaxed":return v.pointSelector.generateRelaxed(n,t,r,$(m.S_lloydIterations).val());case"square":return v.pointSelector.generateSquare(n,t);case"hex":return v.pointSelector.generateHexagon(n,t);default:throw"unknown point selector "+e}}($("#pointSelection").val(),e.map.SIZE.width,e.map.SIZE.height,e.map.mapRandom.seed),p=$(m.S_numberOfLands).val();p.length>0?v.mapLands.tryMutateMapPointsToGetNumberLands(e.map,d,parseInt(p,10),30,2*p):(e.map.go0PlacePoints($(m.S_numberOfPoints).val(),d),e.map.go1BuildGraph(),e.map.go2AssignElevations($(m.S_lakeThreshold).val())),e.map.go3AssignMoisture($(m.S_riverChance).val()),e.map.go4DecorateMap();var y=$(m.S_roadElevationThresholds).val().split(",");e.roads.createRoads(e.map,y),e.watersheds.createWatersheds(e.map),e.noisyEdges.buildNoisyEdges(e.map,e.lava,t,$(m.S_edgeNoise).val()),$("#generateMs").text(g.mark().mark),i(e);var x=g.mark();return $("#renderMs").text(x.mark),$("#totalMs").text(x.total),e},u()},{"./index":8,"./janicek/canvas":10,"./janicek/html-color":13,"./janicek/perf":15,"./janicek/pseudo-random-number-generators":17,"./janicek/string":18,"./janicek/timer":19,lodash:1}],8:[function(e,n){"use strict";n.exports={canvasRender:e("./voronoimap/canvas-render"),islandShape:e("./voronoimap/island-shape"),lava:e("./voronoimap/lava"),map:e("./voronoimap/map"),mapLands:e("./voronoimap/map-lands"),noisyEdges:e("./voronoimap/noisy-edges"),pointSelector:e("./voronoimap/point-selector"),roads:e("./voronoimap/roads"),style:e("./voronoimap/style"),watersheds:e("./voronoimap/watersheds")}},{"./voronoimap/canvas-render":40,"./voronoimap/island-shape":44,"./voronoimap/lava":45,"./voronoimap/map":47,"./voronoimap/map-lands":46,"./voronoimap/noisy-edges":48,"./voronoimap/point-selector":49,"./voronoimap/roads":50,"./voronoimap/style":51,"./voronoimap/watersheds":52}],9:[function(e,n){"use strict";var t=e("./core"),r=e("lodash");n.exports=function(e){return e=t.def(e,[]),{value:e,get:function(n,t){return r(e[t]).isUndefined()?null:e[t][n]},set:function(n,r,i){return e[r]=t.def(e[r],[]),e[r][n]=i,e},foreachY:function(n){r(e).each(function(e){r(e).isUndefined()||n(e)})},foreachXY:function(n){var t;for(t=0;t<e.length;t++)if(!r(e[t]).isUndefined()){var i;for(i=0;i<e[t].length;i++)if(!r(e[t][i]).isUndefined()){var o=e[t][i];null!==o&&n(i,t,o)}}},any:function(n){var t;for(t=0;t<e.length;t++)if(!r(e[t]).isUndefined()){var i;for(i=0;i<e[t].length;i++)if(!r(e[t][i]).isUndefined()){var o=e[t][i];if(null!==o&&n(o))return{x:i,y:t}}}return null},dimensions:function(){var n=e.length,t=0;return this.foreachY(function(e){t=Math.max(t,e.length)}),{x:t,y:n}}}},n.exports.getIndices=function(e,n,r){return r=r||1,{x:e/r%n,y:t.toInt(e/r/n)}}},{"./core":11,lodash:1}],10:[function(e,n,t){"use strict";var r=e("./array2d"),i=e("./core"),o=e("./html-color"),a=e("./math"),u=e("./pseudo-random-number-generators"),s=4,l=0,c=1,f=2,h=3;t.renderCanvasPixelArray=function(e,n){for(var t,r=e.data,o=0;o<i.toInt(r.length/s);o++){t=o*s;var a=n(t,r[t+l],r[t+c],r[t+f],r[t+h]);null!==a&&(null!==a.red&&(r[t+l]=a.red),null!==a.green&&(r[t+c]=a.green),null!==a.blue&&(r[t+f]=a.blue),null!==a.alpha&&(r[t+h]=a.alpha))}},t.addNoise=function(e,n,r,o,s,l,c,f){o=i.def(o,!1),s=i.def(s,!0),l=i.def(l,!0),c=i.def(c,!0),f=i.def(f,!1);var h=u.randomGenerator(n,u.nextParkMiller);r=a.clamp(r,1,255);var d;return t.renderCanvasPixelArray(e,function(e,n,t,i,a){d=u.toIntRange(h(),-r,r);var p={red:null,green:null,blue:null,alpha:null};return s&&(p.red=n+d),l&&(p.green=t+(o?d:u.toIntRange(h(),-r,r))),c&&(p.blue=i+(o?d:u.toIntRange(h(),-r,r))),f&&(p.alpha=a+u.toIntRange(h(),-r,r)),p}),e},t.addNoiseToCanvas=function(e,n,r,o,a,u,s,l){o=i.def(o,!1),a=i.def(a,!0),u=i.def(u,!0),s=i.def(s,!0),l=i.def(l,!1);var c=e.getImageData(0,0,e.canvas.width,e.canvas.height);c=t.addNoise(c,n,r,o,a,u,s,l),e.putImageData(c,0,0)},t.loadFileIntoImage=function(e,n){var t=new FileReader;t.onload=function(e){n.src=e.target.result},t.readAsDataURL(e)},t.getImageData=function(e){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var t=n.getContext("2d");t.drawImage(e,0,0);var r=t.getImageData(0,0,n.width,n.height);return r},t.makeImageDataUrlFromImageData=function(e){var n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),n.toDataURL()},t.makeAverageThresholdImageData=function(e,n,r,u,s){s=i.def(s,1);var l=o.colorFraction(s);return t.renderCanvasPixelArray(e,function(e,t,i,s){var c=a.average([t,i,s])>=n?u:r;return{red:o.getRedComponent(c),green:o.getGreenComponent(c),blue:o.getBlueComponent(c),alpha:l}}),e},t.makeAverageThresholdBitmap=function(e,n){return n=a.clamp(n,0,255),t.makeBitmap(e,function(e,t,r){return a.average([e,t,r])>=n})},t.makeBitmap=function(e,n){var o=r([]),a=i.toInt(e.width);return t.renderCanvasPixelArray(e,function(e,t,i,u,l){var c=r.getIndices(e,a,s);return o.set(c.x,c.y,n(t,i,u,l)),null}),o.value},t.invertBitmap=function(e){var n=r(e);return n.foreachXY(function(e,t,r){n.set(e,t,!r)}),n.value}},{"./array2d":9,"./core":11,"./html-color":13,"./math":14,"./pseudo-random-number-generators":17}],11:[function(e,n){"use strict";var t=e("lodash");n.exports={def:function(e,n){return t.isUndefined(e)?n:e},toInt:function(e){return 0|e},coalesce:function(){return t.find(arguments,function(e){return!t.isNull(e)&&!t.isUndefined(e)})},isUndefinedOrNull:function(e){return t.isUndefined(e)||t.isNull(e)}}},{lodash:1}],12:[function(e,n,t){"use strict";t.djb2=function(e){var n,t=5381;for(n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);return t},t.sdbm=function(e){var n,t=0;for(n=0;n<e.length;n++)t=e.charCodeAt(n)+(t<<6)+(t<<16)-t;return t},t.javaHashCode=function(e){var n=0;if(0===e.length)return n;for(var t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n}},{}],13:[function(e,n,t){"use strict";var r=e("./core");t.MAX_COLOR_COMPONENT=255,t.getRedComponent=function(e){return e>>16&255},t.getGreenComponent=function(e){return e>>8&255},t.getBlueComponent=function(e){return 255&e},t.interpolateColor=function(e,n,t){var i=r.toInt((1-t)*(e>>16)+t*(n>>16)),o=r.toInt((1-t)*(e>>8&255)+t*(n>>8&255)),a=r.toInt((1-t)*(255&e)+t*(255&n));return i>255&&(i=255),o>255&&(o=255),a>255&&(a=255),i<<16|o<<8|a},t.colorFraction=function(e){return r.toInt(t.MAX_COLOR_COMPONENT*e)},t.intToHexColor=function(e){return"#"+("00000"+e.toString(16).toUpperCase()).substr(-6)},t.rgb=function(e,n,t){return"rgb("+e+","+n+","+t+")"},t.rgba=function(e,n,t,r){return"rgba("+e+","+n+","+t+","+r+")"},t.rgbF=function(e,n,t){return"rgb("+100*e+"%,"+100*n+"%,"+100*t+"%)"},t.rgbaF=function(e,n,t,r){return"rgba("+100*e+"%,"+100*n+"%,"+100*t+"%,"+r+")"},t.hsl=function(e,n,t){return"hsl("+e+","+100*n+"%,"+100*t+"%)"},t.hsla=function(e,n,t,r){return"hsla("+e+","+100*n+"%,"+100*t+"%,"+r+")"}},{"./core":11}],14:[function(e,n,t){"use strict";var r=e("lodash");t.average=function(e){return r.reduce(e,function(e,n){return e+n})/r.size(e)},t.clamp=function(e,n,t){var r=Math.min(n,t),i=Math.max(n,t);return r>e?r:e>i?i:e}},{lodash:1}],15:[function(e,n,t){"use strict";var r=e("lodash");t.counters={},t.bumpCounter=function(e){t.counters[e]||(t.counters[e]=0),t.counters[e]++},t.traceCounters=function(){r.each(t.counters,function(e,n){console.log(n,e)})}},{lodash:1}],16:[function(e,n,t){"use strict";var r=e("./array2d"),i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];t.makePerlinNoise=function(e,n,t,o,a,u,s,l){u=u||666,s=s||4,l=l||.5;var c,f,h,d=1/64,p=u=16807*u%2147483647,g=u=16807*u%2147483647,v=u=16807*u%2147483647,m=[],y=[],x=0;for(h=0;s>h;h++)c=Math.pow(2,h),f=Math.pow(l,h),x+=f,m.push(c),y.push(f);x=1/x;var b=r([]),_=t*d+p;o=o*d+g,a=a*d+v;var S;for(S=0;n>S;S++){t=_;var E;for(E=0;e>E;E++){var w=0;for(h=0;s>h;h++){var I=m[h],T=y[h],R=t*I,k=o*I,O=a*I,L=R-R%1,N=k-k%1,C=O-O%1,j=255&L,P=255&N,A=255&C;R-=L,k-=N,O-=C;var D=R*R*R*(R*(6*R-15)+10),F=k*k*k*(k*(6*k-15)+10),M=O*O*O*(O*(6*O-15)+10),B=i[j]+P,$=i[B]+A,z=i[B+1]+A,H=i[j+1]+P,U=i[H]+A,V=i[H+1]+A,G=R-1,W=k-1,q=O-1,Y=15&i[V+1],X=(0===(1&Y)?8>Y?G:W:8>Y?-G:-W)+(0===(2&Y)?4>Y?W:12===Y?G:q:4>Y?-W:14===Y?-G:-q);Y=15&i[z+1];var Q=(0===(1&Y)?8>Y?R:W:8>Y?-R:-W)+(0===(2&Y)?4>Y?W:12===Y?R:q:4>Y?-W:14===Y?-R:-q);Y=15&i[U+1];var Z=(0===(1&Y)?8>Y?G:k:8>Y?-G:-k)+(0===(2&Y)?4>Y?k:12===Y?G:q:4>Y?-k:14===Y?-G:-q);Y=15&i[$+1];var K=(0===(1&Y)?8>Y?R:k:8>Y?-R:-k)+(0===(2&Y)?4>Y?k:12===Y?R:q:4>Y?-k:14===Y?-R:-q);Y=15&i[V];var J=(0===(1&Y)?8>Y?G:W:8>Y?-G:-W)+(0===(2&Y)?4>Y?W:12===Y?G:O:4>Y?-W:14===Y?-G:-O);Y=15&i[z];var en=(0===(1&Y)?8>Y?R:W:8>Y?-R:-W)+(0===(2&Y)?4>Y?W:12===Y?R:O:4>Y?-W:14===Y?-R:-O);Y=15&i[U];var nn=(0===(1&Y)?8>Y?G:k:8>Y?-G:-k)+(0===(2&Y)?4>Y?k:12===Y?G:O:4>Y?-k:14===Y?-G:-O);Y=15&i[$];var tn=(0===(1&Y)?8>Y?R:k:8>Y?-R:-k)+(0===(2&Y)?4>Y?k:12===Y?R:O:4>Y?-k:14===Y?-R:-O);Q+=D*(X-Q),K+=D*(Z-K),en+=D*(J-en),tn+=D*(nn-tn),K+=F*(Q-K),tn+=F*(en-tn),w+=(tn+M*(K-tn))*T}var rn=128*(w*x+1);b.set(E,S,4278190080|rn<<16|rn<<8|rn),t+=d}o+=d}return b.value}},{"./array2d":9}],17:[function(e,n,t){"use strict";var r=e("./hash"),i=2147483647,o=16807;t.makeRandomSeed=function(){return Math.floor(Math.random()*i)},t.nextParkMiller=function(e){return e*o%i},t.nextParkMiller31=function(e){var n=16807*(65535&e),t=16807*(e>>>16);return n+=(32767&t)<<16,n+=t>>>15,n>2147483647&&(n-=2147483647),n},t.nextLCG=function(e){return(1103515245*e+12345)%i},t.toFloat=function(e){return e/i},t.toBool=function(e){return t.toFloat(e)>.5},t.toFloatRange=function(e,n,r){return n+(r-n)*t.toFloat(e)},t.toIntRange=function(e,n,r){return Math.round(n-.4999+(r+.4999-(n-.4999))*t.toFloat(e))},t.stringToSeed=function(e){return r.djb2(e)%i},t.randomGenerator=function(e,n){return function(){return e=n(e)}}},{"./hash":12}],18:[function(e,n){"use strict";n.exports=function(e){return{startsWith:function(n){return 0===e.indexOf(n)}}}},{}],19:[function(e,n){"use strict";n.exports=function(){var e,n;return{start:function(){e=n=Date.now()},mark:function(){var t=Date.now(),r={mark:t-n,total:t-e};return n=t,r}}}},{}],20:[function(e,n){"use strict";n.exports={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8,check:function(n,t){t=e("../../as3/rectangle").core(t);var r=0;return n.x===t.left()&&(r|=this.LEFT),n.x===t.right()&&(r|=this.RIGHT),n.y===t.top()&&(r|=this.TOP),n.y===t.bottom()&&(r|=this.BOTTOM),r}}},{"../../as3/rectangle":5}],21:[function(e,n){"use strict";n.exports={vertex:"vertex",site:"site"}},{}],22:[function(e,n){"use strict";var t=e("lodash");n.exports={delaunayLinesForEdges:function(e){var n=[];return t(e).each(function(e){n.push(e.delaunayLine())}),n},selectEdgesForSitePoint:function(e,n){return t(n).filter(function(n){return null!==n.leftSite&&n.leftSite.coord===e||null!==n.rightSite&&n.rightSite.coord===e})},selectNonIntersectingEdges:function(e,n){if(null===e)return n;var r={x:0,y:0};return t(n).filter(function(n){var t=n.makeDelaunayLineBmp(),i=!e.hitTest(r,1,t,r,1);return t.dispose(),i})},visibleLineSegments:function(n){var r=e("./lr"),i=e("../geom/line-segment"),o=[];return t(n).each(function(e){if(e.visible){var n=e.clippedEnds[r.LEFT],t=e.clippedEnds[r.RIGHT];o.push(i(n,t))}}),o}}},{"../geom/line-segment":36,"./lr":29,lodash:1}],23:[function(e,n){"use strict";var t=e("./halfedge"),r=e("./edge");n.exports=function(e,n,i){function o(e){var n;return 0>e||e>=l?null:(n=c[e],null!==n&&n.edge===r.DELETED?(c[e]=null,null):n)}var a={},u=0,s=0,l=0,c=[],f=null;a.getLeftEnd=function(){return f},Object.defineProperties(a,{leftEnd:{get:function(){return a.getLeftEnd()}}});var h=null;return a.getRightEnd=function(){return h},Object.defineProperties(a,{rightEnd:{get:function(){return a.getRightEnd()}}}),a.dispose=function(){for(var e,n=f;n!==h;)e=n,n=n.edgeListRightNeighbor,e.dispose();f=null,h.dispose(),h=null;var t;for(t=0;l>t;t++)c[t]=null;c=null},a.insert=function(e,n){n.edgeListLeftNeighbor=e,n.edgeListRightNeighbor=e.edgeListRightNeighbor,e.edgeListRightNeighbor.edgeListLeftNeighbor=n,e.edgeListRightNeighbor=n},a.remove=function(e){e.edgeListLeftNeighbor.edgeListRightNeighbor=e.edgeListRightNeighbor,e.edgeListRightNeighbor.edgeListLeftNeighbor=e.edgeListLeftNeighbor,e.edge=r.DELETED,e.edgeListLeftNeighbor=e.edgeListRightNeighbor=null},a.edgeListLeftNeighbor=function(e){var n,t;if(n=(e.x-s)/u*l,0>n&&(n=0),n>=l&&(n=l-1),t=o(n),null===t)for(var r=1;;){if(null!==(t=this.getHash(n-r)))break;if(null!==(t=this.getHash(n+r)))break;r++}if(t===this.getLeftEnd()||t!==this.getRightEnd()&&t.isLeftOf(e)){do t=t.edgeListRightNeighbor;while(t!==this.getRightEnd()&&t.isLeftOf(e));t=t.edgeListLeftNeighbor}else do t=t.edgeListLeftNeighbor;while(t!==this.getLeftEnd()&&!t.isLeftOf(e));return n>0&&l-1>n&&(c[n]=t),t},s=e,u=n,l=2*i,c=[],f=t.createDummy(),h=t.createDummy(),f.edgeListLeftNeighbor=null,f.edgeListRightNeighbor=h,h.edgeListLeftNeighbor=f,h.edgeListRightNeighbor=null,c[0]=f,c[l-1]=h,a}},{"./edge":25,"./halfedge":27}],24:[function(e,n){"use strict";var t=e("./criterion"),r=e("./lr"),i=e("./vertex"),o=function(e,n){if(n!==t.vertex&&n!==t.site)throw"Edges: criterion must be Vertex or Site";this.edges=[],this.edgeOrientations=[],e.length>0&&(this.edges=this._reorderEdges(e,n))};o.prototype={edges:null,edgeOrientations:null,dispose:function(){this.edges=null,this.edgeOrientations=null},_reorderEdges:function(e,n){var o,a,u=e.length,s=[],l=0,c=[];o=0,a=e[o],c.push(a),this.edgeOrientations.push(r.LEFT);var f,h;if(n===t.vertex?(f=a.leftVertex,h=a.rightVertex):(f=a.leftSite,h=a.rightSite),f===i.VERTEX_AT_INFINITY||h===i.VERTEX_AT_INFINITY)return[];for(s[o]=!0,++l;u>l;)for(o=1;u>o;o++)if(!s[o]){a=e[o];var d,p;if(n===t.vertex?(d=a.leftVertex,p=a.rightVertex):(d=a.leftSite,p=a.rightSite),d===i.VERTEX_AT_INFINITY||p===i.VERTEX_AT_INFINITY)return[];d===h?(h=p,this.edgeOrientations.push(r.LEFT),c.push(a),s[o]=!0):p===f?(f=d,this.edgeOrientations.unshift(r.LEFT),c.unshift(a),s[o]=!0):d===f?(f=p,this.edgeOrientations.unshift(r.RIGHT),c.unshift(a),s[o]=!0):p===h&&(h=d,this.edgeOrientations.push(r.RIGHT),c.push(a),s[o]=!0),s[o]&&++l}return c}},n.exports=function(e,n){return new o(e,n)}},{"./criterion":21,"./lr":29,"./vertex":33}],25:[function(e,n,t){"use strict";function r(){var e;return s.length>0?(e=s.pop(),e.init()):e=new t.Edge,e}var i=e("../geom/line-segment"),o=e("./lr"),a=e("../../as3/point-core"),u=e("../../as3/rectangle"),s=[],l=0;t.Edge=function(){this._edgeIndex=l++,this.init()},t.Edge.prototype={_delaunayLineBmp:null,getDelaunayLineBmp:function(){return null===this._delaunayLineBmp&&(this._delaunayLineBmp=this.makeDelaunayLineBmp()),this._delaunayLineBmp},get delaunayLineBmp(){return this.getDelaunayLineBmp()},makeDelaunayLineBmp:function(){throw"unimplemented"},delaunayLine:function(){return i(this.leftSite.coord,this.rightSite.coord)},voronoiEdge:function(){return this.visible?i(this.clippedEnds[o.LEFT],this.clippedEnds[o.RIGHT]):i(null,null)},a:null,b:null,c:null,leftVertex:null,rightVertex:null,vertex:function(e){return e===o.LEFT?this.leftVertex:this.rightVertex},setVertex:function(e,n){e===o.LEFT?this.leftVertex=n:this.rightVertex=n},isPartOfConvexHull:function(){return null===this.leftVertex||null===this.rightVertex},sitesDistance:function(){return a.distance(this.leftSite.coord,this.rightSite.coord)},clippedEnds:null,get visible(){return null!==this.clippedEnds},leftSite:null,rightSite:null,site:function(e){return e===o.LEFT?this.leftSite:this.rightSite},_edgeIndex:0,dispose:function(){null!==this._delaunayLineBmp&&(this._delaunayLineBmp.dispose(),this._delaunayLineBmp=null),this.leftVertex=null,this.rightVertex=null,null!==this.clippedEnds&&(this.clippedEnds[o.LEFT]=null,this.clippedEnds[o.RIGHT]=null,this.clippedEnds=null),this.leftSite=null,this.rightSite=null,s.push(this)},toString:function(){return"Edge "+this._edgeIndex+"; sites "+this.leftSite+", "+this.rightSite+"; endVertices "+(null!==this.leftVertex?String(this.leftVertex.vertexIndex):"null")+", "+(null!==this.rightVertex?String(this.rightVertex.vertexIndex):"null")+"::"},clipVertices:function(e){var n,t,r,i,a,s,l=u.core(e),c=e.x,f=e.y,h=l.right(),d=l.bottom();if(1===this.a&&this.b>=0?(n=this.rightVertex,t=this.leftVertex):(n=this.leftVertex,t=this.rightVertex),1===this.a){if(a=f,null!==n&&n.y>f&&(a=n.y),a>d)return;if(r=this.c-this.b*a,s=d,null!==t&&t.y<d&&(s=t.y),f>s)return;if(i=this.c-this.b*s,r>h&&i>h||c>r&&c>i)return;r>h?(r=h,a=(this.c-r)/this.b):c>r&&(r=c,a=(this.c-r)/this.b),i>h?(i=h,s=(this.c-i)/this.b):c>i&&(i=c,s=(this.c-i)/this.b)}else{if(r=c,null!==n&&n.x>c&&(r=n.x),r>h)return;if(a=this.c-this.a*r,i=h,null!==t&&t.x<h&&(i=t.x),c>i)return;if(s=this.c-this.a*i,a>d&&s>d||f>a&&f>s)return;a>d?(a=d,r=(this.c-a)/this.a):f>a&&(a=f,r=(this.c-a)/this.a),s>d?(s=d,i=(this.c-s)/this.a):f>s&&(s=f,i=(this.c-s)/this.a)}this.clippedEnds={},n===this.leftVertex?(this.clippedEnds[o.LEFT]={x:r,y:a},this.clippedEnds[o.RIGHT]={x:i,y:s}):(this.clippedEnds[o.RIGHT]={x:r,y:a},this.clippedEnds[o.LEFT]={x:i,y:s})},init:function(){this.leftSite=null,this.rightSite=null}},t.DELETED=new t.Edge,t.createBisectingEdge=function(e,n){var t,i,o,a,u,s,l;t=n.x-e.x,i=n.y-e.y,o=t>0?t:-t,a=i>0?i:-i,l=e.x*t+e.y*i+.5*(t*t+i*i),o>a?(u=1,s=i/t,l/=t):(s=1,u=t/i,l/=i);var c=r();return c.leftSite=e,c.rightSite=n,e.addEdge(c),n.addEdge(c),c.leftVertex=null,c.rightVertex=null,c.a=u,c.b=s,c.c=l,c},t.compareSitesDistancesMax=function(e,n){var t=e.sitesDistance(),r=n.sitesDistance();return r>t?1:t>r?-1:0},t.compareSitesDistances=function(e,n){return-t.compareSitesDistancesMax(e,n)}},{"../../as3/point-core":4,"../../as3/rectangle":5,"../geom/line-segment":36,"./lr":29}],26:[function(e,n){"use strict";var t=e("./halfedge"),r=e("../../janicek/core");n.exports=function(e,n,i){function o(){var e;for(f=0,h=0,c=[],e=0;d>e;e++)c[e]=t.createDummy(),c[e].nextInPriorityQueue=null}function a(e){var n=r.toInt((e.ystar-p)/g*d);return 0>n&&(n=0),n>=d&&(n=d-1),n}function u(e){return null===c[e].nextInPriorityQueue}function s(){for(;d-1>h&&u(h);)++h}var l={},c=null,f=0,h=0,d=0,p=0,g=0;return l.dispose=function(){var e;for(e=0;d>e;e++)c[e].dispose(),c[e]=null;c=null},l.insert=function(e){var n,t,r=a(e);for(h>r&&(h=r),n=c[r];null!==(t=n.nextInPriorityQueue)&&(e.ystar>t.ystar||e.ystar===t.ystar&&e.vertex.x>t.vertex.x);)n=t;e.nextInPriorityQueue=n.nextInPriorityQueue,n.nextInPriorityQueue=e,++f},l.remove=function(e){var n,t=a(e);if(null!==e.vertex){for(n=c[t];n.nextInPriorityQueue!==e;)n=n.nextInPriorityQueue;n.nextInPriorityQueue=e.nextInPriorityQueue,f--,e.vertex=null,e.nextInPriorityQueue=null,e.dispose()}},l.empty=function(){return 0===f},l.min=function(){s();var e=c[h].nextInPriorityQueue;return{x:e.vertex.x,y:e.ystar}},l.extractMin=function(){var e;return e=c[h].nextInPriorityQueue,c[h].nextInPriorityQueue=e.nextInPriorityQueue,f--,e.nextInPriorityQueue=null,e},p=e,g=n,d=4*i,o(),l}},{"../../janicek/core":11,"./halfedge":27}],27:[function(e,n,t){"use strict";var r=e("../../janicek/core").def,i=e("./lr"),o=[],a=function(e,n){e=r(e,null),n=r(n,null),this.init(e,n)};a.prototype={edgeListLeftNeighbor:null,edgeListRightNeighbor:null,nextInPriorityQueue:null,edge:null,leftRight:null,vertex:null,ystar:0,toString:function(){return"Halfedge (leftRight: "+this.leftRight+"; vertex: "+this.vertex+")"},dispose:function(){null===this.edgeListLeftNeighbor&&null===this.edgeListRightNeighbor&&null===this.nextInPriorityQueue&&(this.edge=null,this.leftRight=null,this.vertex=null,o.push(this))},reallyDispose:function(){this.edgeListLeftNeighbor=null,this.edgeListRightNeighbor=null,this.nextInPriorityQueue=null,this.edge=null,this.leftRight=null,this.vertex=null,o.push(this)},isLeftOf:function(e){var n,t,r,o,a,u,s,l,c,f,h;return n=this.edge.rightSite,t=e.x>n.x,t&&this.leftRight===i.LEFT?!0:t||this.leftRight!==i.RIGHT?(1===this.edge.a?(u=e.y-n.y,a=e.x-n.x,o=!1,!t&&this.edge.b<0||t&&this.edge.b>=0?(r=u>=this.edge.b*a,o=r):(r=e.x+e.y*this.edge.b>this.edge.c,this.edge.b<0&&(r=!r),r||(o=!0)),o||(s=n.x-this.edge.leftSite.x,r=this.edge.b*(a*a-u*u)<s*u*(1+2*a/s+this.edge.b*this.edge.b),this.edge.b<0&&(r=!r))):(h=this.edge.c-this.edge.a*e.x,l=e.y-h,c=e.x-n.x,f=h-n.y,r=l*l>c*c+f*f),this.leftRight===i.LEFT?r:!r):!1},init:function(e,n){return this.edge=e,this.leftRight=n,this.nextInPriorityQueue=null,this.vertex=null,this}},t.create=function(e,n){return o.length>0?o.pop().init(e,n):new a(e,n)},t.createDummy=function(){return t.create(null,null)}},{"../../janicek/core":11,"./lr":29}],28:[function(e,n,t){"use strict";var r=e("lodash"),i=e("../../janicek/core").def,o=e("../geom/line-segment").core,a=e("./node"),u=e("../../as3/point-core");t.find=function(e){if(e.parent===e)return e;var n=t.find(e.parent);return e.parent=n,n},t.kruskal=function(e,n){n=i(n,"minimum");var s={},l=[],c=[];switch(n){case"maximum":e.sort(o.compareLengths);break;default:e.sort(o.compareLengthsMax)}for(var f=e.length-1;f>=0;){var h=e[f];f--;var d,p=s[u.hash(h.p0)];null===p?(p=c.length>0?c.pop():a(),d=p.parent=p,p.treeSize=1,s[u.hash(h.p0)]=p):d=t.find(p);var g,v=s[u.hash(h.p1)];if(null===v?(v=c.length>0?c.pop():a(),g=v.parent=v,v.treeSize=1,s[u.hash(h.p1)]=v):g=t.find(v),d!==g){l.push(h);var m=d.treeSize,y=g.treeSize;m>=y?(g.parent=d,d.treeSize+=y):(d.parent=g,g.treeSize+=m)}}return r(s).each(function(e){c.push(e)}),l}},{"../../as3/point-core":4,"../../janicek/core":11,"../geom/line-segment":36,"./node":30,lodash:1}],29:[function(e,n){"use strict";n.exports={LEFT:"left",RIGHT:"right",other:function(e){return e===this.LEFT?this.RIGHT:this.LEFT}}},{}],30:[function(e,n){"use strict";n.exports=function(){return{parent:null,treeSize:0}},n.exports.pool=[]},{}],31:[function(e,n){"use strict";var t=e("lodash"),r=e("../geom/circle"),i=e("../../janicek/core").def,o=e("../../as3/rectangle"),a=e("./site");n.exports=function(){var e=[],n=0,u=!1,s={};return s.dispose=function(){null!==e&&(t(e).each(function(e){e.dispose()}),e=null)},s.push=function(n){return u=!1,e.push(n)},Object.defineProperties(s,{length:{get:function(){return e.length}}}),s.next=function(){if(u===!1)throw"SiteList::next():  sites have not been sorted";return n<e.length?e[n++]:null},s.getSitesBounds=function(){u===!1&&(a.sortSites(e),n=0,u=!0);var r,i,s,l;return 0===e.length?o(0,0,0,0):(r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,t(e).each(function(e){e.x<r&&(r=e.x),e.x>i&&(i=e.x)}),s=e[0].y,l=e[e.length-1].y,o(r,s,i-r,l-s))},s.siteColors=function(n){n=i(n,null);var r=[];return t(e).each(function(e){r.push(null!==n?n.getPixel(e.x,e.y):e.color)}),r},s.siteCoords=function(){var n=[];return t(e).each(function(e){n.push(e.coord)}),n},s.circles=function(){var n=[];return t(e).each(function(e){var t=e.nearestEdge(),i=t.isPartOfConvexHull()?0:.5*t.sitesDistance();n.push(r(e.x,e.y,i))}),n},s.regions=function(n){var r=[];return t(e).each(function(e){r.push(e.region(n))}),r},s.nearestSitePoint=function(n,t,r){var i=n.getPixel(t,r);return i>e.length-1?null:e[i].coord},s}},{"../../as3/rectangle":5,"../../janicek/core":11,"../geom/circle":35,"./site":32,lodash:1}],32:[function(e,n,t){"use strict";
function r(e,n){return f.distance(e,n)<m}var i=e("lodash"),o=e("./bounds-check"),a=e("./criterion"),u=e("../../janicek/core").def,s=e("./edge"),l=e("./edge-reorderer"),c=e("./lr"),f=e("../../as3/point-core"),h=e("../geom/polygon"),d=e("../../as3/rectangle").core,p=e("./voronoi"),g=e("../geom/winding"),v=[],m=.005,y=function(e,n,t,r){this.init(e,n,t,r)};y.prototype={_coord:null,get coord(){return this._coord},color:0,weight:0,_siteIndex:0,_edges:null,get edges(){return this._edges},_edgeOrientations:null,_region:null,init:function(e,n,t,r){return this._coord=e,this._siteIndex=n,this.weight=t,this.color=r,this._edges=[],this._region=null,this},toString:function(){return"Site "+this._siteIndex+": "+String(this.coord)},dispose:function(){this._coord=null,this._clear(),v.push(this)},_clear:function(){null!==this._edges&&(this._edges=null),null!==this._edgeOrientations&&(this._edgeOrientations=null),null!==this._region&&(this._region=null)},addEdge:function(e){this._edges.push(e)},nearestEdge:function(){return this._edges.sort(s.compareSitesDistances),this._edges[0]},neighborSites:function(){if(null===this._edges||0===this._edges.length)return[];null===this._edgeOrientations&&this._reorderEdges();var e=[];return i.each(this._edges,function(n){e.push(this._neighborSite(n))}),e},_neighborSite:function(e){return this===e.leftSite?e.rightSite:this===e.rightSite?e.leftSite:null},region:function(e){return null===this._edges||0===this._edges.length?[]:(null===this._edgeOrientations&&(this._reorderEdges(),this._region=this._clipToBounds(e),h(this._region).winding()===g.CLOCKWISE&&this._region.reverse()),this._region)},_reorderEdges:function(){var e=l(this._edges,a.vertex);this._edges=e.edges,this._edgeOrientations=e.edgeOrientations,e.dispose()},_clipToBounds:function(e){for(var n=[],t=this._edges.length,r=0,i=null;t>r&&this._edges[r].visible===!1;)++r;if(r===t)return[];i=this._edges[r];var o=this._edgeOrientations[r];n.push(i.clippedEnds[o]),n.push(i.clippedEnds[c.other(o)]);for(var a=r+1;t>a;a++)i=this._edges[a],i.visible!==!1&&this._connect(n,a,e);return this._connect(n,r,e,!0),n},_connect:function(e,n,t,i){i=u(i,!1);var a=e[e.length-1],s=this._edges[n],l=this._edgeOrientations[n],f=s.clippedEnds[l];if(!r(a,f)){if(a.x!==f.x&&a.y!==f.y){var h,p,g=o.check(a,t),v=o.check(f,t);0!==(g&o.RIGHT)?(h=d(t).right(),0!==(v&o.BOTTOM)?(p=d(t).bottom(),e.push({x:h,y:p})):0!==(v&o.TOP)?(p=d(t).top(),e.push({x:h,y:p})):0!==(v&o.LEFT)&&(p=a.y-t.y+f.y-t.y<t.height?d(t).top():d(t).bottom(),e.push({x:h,y:p}),e.push({x:d(t).left(),y:p}))):0!==(g&o.LEFT)?(h=d(t).left(),0!==(v&o.BOTTOM)?(p=d(t).bottom(),e.push({x:h,y:p})):0!==(v&o.TOP)?(p=d(t).top(),e.push({x:h,y:p})):0!==(v&o.RIGHT)&&(p=a.y-t.y+f.y-t.y<t.height?d(t).top():d(t).bottom(),e.push({x:h,y:p}),e.push({x:d(t).right(),y:p}))):0!==(g&o.TOP)?(p=d(t).top(),0!==(v&o.RIGHT)?(h=d(t).right(),e.push({x:h,y:p})):0!==(v&o.LEFT)?(h=d(t).left(),e.push({x:h,y:p})):0!==(v&o.BOTTOM)&&(h=a.x-t.x+f.x-t.x<t.width?d(t).left():d(t).right(),e.push({x:h,y:p}),e.push({x:h,y:d(t).bottom()}))):0!==(g&o.BOTTOM)&&(p=d(t).bottom(),0!==(v&o.RIGHT)?(h=d(t).right(),e.push({x:h,y:p})):0!==(v&o.LEFT)?(h=d(t).left(),e.push({x:h,y:p})):0!==(v&o.TOP)&&(h=a.x-t.x+f.x-t.x<t.width?d(t).left():d(t).right(),e.push({x:h,y:p}),e.push({x:h,y:d(t).top()})))}if(i)return;e.push(f)}var m=s.clippedEnds[c.other(l)];r(e[0],m)||e.push(m)},get x(){return this._coord.x},get y(){return this._coord.y},dist:function(e){return f.distance(e.coord,this.coord)}},t.create=function(e,n,t,r){return v.length>0?v.pop().init(e,n,t,r):new y(e,n,t,r)},t.sortSites=function(e){e.sort(p.compareSiteByYThenX),i(e).each(function(n,t){e[t]._siteIndex=t})}},{"../../as3/point-core":4,"../../as3/rectangle":5,"../../janicek/core":11,"../geom/polygon":37,"../geom/winding":38,"./bounds-check":20,"./criterion":21,"./edge":25,"./edge-reorderer":24,"./lr":29,"./voronoi":34,lodash:1}],33:[function(e,n,t){"use strict";function r(e,n){return isNaN(e)||isNaN(n)?t.VERTEX_AT_INFINITY:i.length>0?i.pop().init(e,n):new a(e,n)}var i=[],o=0,a=function(e,n){this.init(e,n)};a.prototype={_coord:null,get coord(){return this._coord},vertexIndex:0,init:function(e,n){return this._coord={x:e,y:n},this},dispose:function(){this._coord=null,i.push(this)},setIndex:function(){this.vertexIndex=o++},toString:function(){return"Vertex ("+this.vertexIndex+")"},get x(){return this._coord.x},get y(){return this._coord.y}},t.VERTEX_AT_INFINITY=new a(0/0,0/0),t.intersect=function(n,t){var i,o,a,u,s,l,c,f,h=e("./voronoi"),d=e("./lr");return i=n.edge,o=t.edge,null===i||null===o?null:i.rightSite===o.rightSite?null:(s=i.a*o.b-i.b*o.a,s>-1e-10&&1e-10>s?null:(l=(i.c*o.b-o.c*i.b)/s,c=(o.c*i.a-i.c*o.a)/s,h.compareSiteByYThenX(i.rightSite,o.rightSite)<0?(u=n,a=i):(u=t,a=o),f=l>=a.rightSite.x,f&&u.leftRight===d.LEFT||!f&&u.leftRight===d.RIGHT?null:r(l,c)))}},{"./lr":29,"./voronoi":34}],34:[function(e,n,t){"use strict";var r=e("lodash"),i=e("./criterion"),o=e("../../janicek/core"),a=e("../../janicek/core").def,u=e("./delaunay"),s=e("./edge-list"),l=e("./edge"),c=e("./edge-reorderer"),f=e("./halfedge"),h=e("./halfedge-priority-queue"),d=e("./kruskal"),p=e("./lr"),g=e("../../as3/point-core"),v=e("../../polygonal/pm-prng"),m=e("./site-list"),y=e("./site"),x=e("./vertex");t.make=function(e,n,b){function _(e){var n={};r(e).each(function(e){if(r(n).has(g.hash(e)))throw"Duplicate points not supported yet!";n[g.hash(e)]=e})}function S(e,n){for(var t=e.length,r=0;t>r;r++)E(e[r],null!==n?n[r]:0,r)}function E(e,n,t){var r=100*T.nextDouble(),i=y.create(e,t,r,n);R.push(i),k[g.hash(e)]=i}function w(){return r(L).filter(function(e){return e.isPartOfConvexHull()})}function I(){function e(e){var n=e.edge;return null===n?P:n.site(e.leftRight)}function n(e){var n=e.edge;return null===n?P:n.site(p.other(e.leftRight))}var i,a,u,c,d,g,v,m,y,b,_,S,E,w,I=R.getSitesBounds(),T=o.toInt(Math.sqrt(R.length+4)),k=h(I.y,I.height,T),O=s(I.x,I.width,T),C=[],j=[],P=R.next();for(i=R.next();;)if(k.empty()===!1&&(v=k.min()),null!==i&&(k.empty()||t.comparePointByYThenX(i,v)<0))y=O.edgeListLeftNeighbor(i.coord),b=y.edgeListRightNeighbor,a=n(y),w=l.createBisectingEdge(a,i),L.push(w),E=f.create(w,p.LEFT),C.push(E),O.insert(y,E),null!==(g=x.intersect(y,E))&&(j.push(g),k.remove(y),y.vertex=g,y.ystar=g.y+i.dist(g),k.insert(y)),y=E,E=f.create(w,p.RIGHT),C.push(E),O.insert(y,E),null!==(g=x.intersect(E,b))&&(j.push(g),E.vertex=g,E.ystar=g.y+i.dist(g),k.insert(E)),i=R.next();else{if(k.empty()!==!1)break;y=k.extractMin(),_=y.edgeListLeftNeighbor,b=y.edgeListRightNeighbor,S=b.edgeListRightNeighbor,a=e(y),u=n(b),d=y.vertex,d.setIndex(),y.edge.setVertex(y.leftRight,d),b.edge.setVertex(b.leftRight,d),O.remove(y),k.remove(b),O.remove(b),m=p.LEFT,a.y>u.y&&(c=a,a=u,u=c,m=p.RIGHT),w=l.createBisectingEdge(a,u),L.push(w),E=f.create(w,m),C.push(E),O.insert(_,E),w.setVertex(p.other(m),d),null!==(g=x.intersect(_,E))&&(j.push(g),k.remove(_),_.vertex=g,_.ystar=g.y+a.dist(g),k.insert(_)),null!==(g=x.intersect(E,S))&&(j.push(g),E.vertex=g,E.ystar=g.y+a.dist(g),k.insert(E))}k.dispose(),O.dispose(),r(C).each(function(e){e.reallyDispose()}),r(L).each(function(e){e.clipVertices(N.plotBounds)}),r(j).each(function(e){e.dispose()})}var T=v(),R=m(),k={},O=[],L=[],N={};return N.plotBounds=b,N.dispose=function(){var e,n;if(null!==R&&(R.dispose(),R=null),null!==O){for(n=O.length,e=0;n>e;e++)O[e].dispose();O=null}if(null!==L){for(n=L.length,e=0;n>e;e++)L[e].dispose();L=null}N.plotBounds=null,k=null},N.edges=function(){return L},N.region=function(e){var n=k[g.hash(e)];return null===n?[]:n.region(N.plotBounds)},N.neighborSitesForSite=function(e){var n=[],t=k[g.hash(e)];if(null===t)return n;var i=t.neighborSites();return r(i).each(function(e){n.push(e.coord)}),n},N.circles=function(){return R.circles()},N.voronoiBoundaryForSite=function(e){return u.visibleLineSegments(u.selectEdgesForSitePoint(e,L))},N.delaunayLinesForSite=function(e){return u.delaunayLinesForEdges(u.selectEdgesForSitePoint(e,L))},N.voronoiDiagram=function(){return u.visibleLineSegments(L)},N.delaunayTriangulation=function(e){return e=a(e,null),u.delaunayLinesForEdges(u.selectNonIntersectingEdges(e,L))},N.hull=function(){return u.delaunayLinesForEdges(w())},N.hullPointsInOrder=function(){var e=e(),n=[];if(0===e.length)return n;var t=c(e,i.site);e=t.edges;var r=t.edgeOrientations;t.dispose();var o,a,u=e.length;for(a=0;u>a;a++){var s=e[a];o=r[a],n.push(s.site(o).coord)}return n},N.spanningTree=function(e,n){e=a(e,"minimum"),n=a(n,null);var t=u.selectNonIntersectingEdges(n,L),r=u.delaunayLinesForEdges(t);return d.kruskal(r,e)},N.regions=function(){return R.regions(N.plotBounds)},N.siteColors=function(e){return e=a(e,null),R.siteColors(e)},N.nearestSitePoint=function(e,n,t){return R.nearestSitePoint(e,n,t)},N.siteCoords=function(){return R.siteCoords()},_(e),T.seed=1,S(e,n),I(),N},t.isInfSite=function(e,n){return e.y<n.y||e.y===n.y&&e.x<n.x},t.comparePointByYThenX=function(e,n){return t.compareByYThenX(e.x,e.y,n.x,n.y)},t.compareSiteByYThenX=function(e,n){return t.compareByYThenX(e.x,e.y,n.x,n.y)},t.compareByYThenX=function(e,n,t,r){return r>n?-1:n>r?1:t>e?-1:e>t?1:0}},{"../../as3/point-core":4,"../../janicek/core":11,"../../polygonal/pm-prng":39,"./criterion":21,"./delaunay":22,"./edge":25,"./edge-list":23,"./edge-reorderer":24,"./halfedge":27,"./halfedge-priority-queue":26,"./kruskal":28,"./lr":29,"./site":32,"./site-list":31,"./vertex":33,lodash:1}],35:[function(e,n){"use strict";n.exports=function(e,n,t){return{center:{x:e,y:n},radius:t,toString:function(){return"Circle (center: "+this.center+"; radius: "+this.radius+")"}}}},{}],36:[function(e,n){"use strict";var t=e("../../as3/point-core");n.exports=function(e,n){return{p0:e,p1:n}},n.exports.core={compareLengthsMax:function(e,n){var r=t.distance(e.p0,e.p1),i=t.distance(n.p0,n.p1);return i>r?1:r>i?-1:0},compareLengths:function(e,n){return-this.compareLengthsMax(e,n)}}},{"../../as3/point-core":4}],37:[function(e,n){"use strict";var t=e("./winding"),r=function(e){this._vertices=e};r.prototype={area:function(){return Math.abs(.5*this.signedDoubleArea())},winding:function(){var e=this.signedDoubleArea();return 0>e?t.CLOCKWISE:e>0?t.COUNTERCLOCKWISE:t.NONE},signedDoubleArea:function(){var e,n,t,r,i=this._vertices.length,o=0;for(e=0;i>e;e++)n=(e+1)%i,t=this._vertices[e],r=this._vertices[n],o+=t.x*r.y-r.x*t.y;return o}},n.exports=function(e){return new r(e)}},{"./winding":38}],38:[function(e,n){"use strict";n.exports={CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise",NONE:"none"}},{}],39:[function(e,n){"use strict";n.exports=function(){return{seed:1,nextDouble:function(){return this.gen()/2147483647},nextIntRange:function(e,n){return e-=.4999,n+=.4999,Math.round(e+(n-e)*this.nextDouble())},nextDoubleRange:function(e,n){return e+(n-e)*this.nextDouble()},gen:function(){return this.seed=16807*this.seed%2147483647,this.seed}}}},{}],40:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++)e.lineTo(n[t].x,n[t].y)}function i(e,n,t,r,i,o,s,l){var f=c(),d=n.add(t).add(r);d.scaleBy(1/3);var p=t.subtract(n).crossProduct(r.subtract(n));p.normalize();var g=h(-p.x/p.z,-p.y/p.z,0),v=h(d.x-g.x*((d.z-.5)/g.length/g.length),d.y-g.y*((d.z-.5)/g.length/g.length));if(g.length<1e-6){var m=i[0];2===i.length?m=u.interpolateColor(i[0],i[1],d.z):3===i.length&&(m=d.z<.5?u.interpolateColor(i[0],i[1],2*d.z):u.interpolateColor(i[1],i[2],2*d.z-1)),e.fillStyle=u.intToHexColor(m)}else{f.createGradientBox(1,1,0,0,0),f.translate(-.5,-.5),f.scale(1/g.length,1/g.length),f.rotate(Math.atan2(g.y,g.x)),f.translate(v.x,v.y);{a(i).map(function(){return 1}),a(i).map(function(e,n){return 255*n/(i.length-1)})}}o(e,s,l),e.fill()}function o(e,n){for(var t=n.length-1;t>=0;)e.lineTo(n[t].x,n[t].y),t--}var a=e("lodash"),u=e("../janicek/html-color"),s=e("../as3/conversion-core"),l=e("../janicek/core"),c=e("../as3/matrix"),f=e("../as3/point-core"),h=e("../as3/vector-3d");t.graphicsReset=function(e,n,t,r){e.lineWidth=1,e.clearRect(0,0,2e3,2e3),e.fillStyle="#bbbbaa",e.fillRect(0,0,2e3,2e3),e.fillStyle=u.intToHexColor(r.OCEAN),e.fillRect(0,0,l.toInt(n),l.toInt(t))};var d=h(-1,-1,0);t.calculateLighting=function(e,n,t){var r=h(e.point.x,e.point.y,e.elevation),i=h(n.point.x,n.point.y,n.elevation),o=h(t.point.x,t.point.y,t.elevation),a=i.subtract(r).crossProduct(o.subtract(r));a.z<0&&a.scaleBy(-1),a.normalize();var u=.5+35*a.dotProduct(d);return 0>u&&(u=0),u>1&&(u=1),u},t.colorWithSlope=function(e,n,r,i,o){var s=i.v0,l=i.v1;if(a.isNull(s)||a.isNull(l))return o.OCEAN;if(n.water)return e;null!==r&&n.water===r.water&&(e=u.interpolateColor(e,o[r.biome],.4));var c=u.interpolateColor(e,3355443,.7),f=u.interpolateColor(e,16777215,.3),h=t.calculateLighting(n,s,l);return.5>h?u.interpolateColor(c,e,2*h):u.interpolateColor(e,f,2*h-1)},t.colorWithSmoothColors=function(e,n,t,r,i){return null!==t&&n.water===t.water&&(e=u.interpolateColor(i[n.biome],i[t.biome],.25)),e},t.renderDebugPolygons=function(e,n,t){var r;0===n.centers.length&&(e.fillStyle="#dddddd",e.fillRect(0,0,l.toInt(n.SIZE.width),l.toInt(n.SIZE.height)),a(n.points).each(function(n){e.beginPath(),e.strokeStyle="#000000",e.fillStyle="#000000",e.arc(n.x,n.y,1.3,Math.PI,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()})),a(n.centers).each(function(n){r=a.isNull(n.biome)?n.ocean?t.OCEAN:n.water?t.RIVER:16777215:t[n.biome],e.beginPath(),a(n.borders).each(function(t){a.isNull(t.v0)||a.isNull(t.v1)||(e.moveTo(n.point.x,n.point.y),e.lineTo(t.v0.point.x,t.v0.point.y),e.lineTo(t.v1.point.x,t.v1.point.y))}),e.closePath(),e.fillStyle=u.intToHexColor(u.interpolateColor(r,14540253,.2)),e.fill(),a(n.borders).each(function(n){a.isNull(n.v0)||a.isNull(n.v1)||(e.beginPath(),e.moveTo(n.v0.point.x,n.v0.point.y),n.river>0?(e.lineWidth=1,e.strokeStyle=u.intToHexColor(t.RIVER)):(e.lineWidth=.1,e.strokeStyle="#000000"),e.lineTo(n.v1.point.x,n.v1.point.y),e.closePath(),e.stroke())}),e.beginPath(),e.fillStyle=n.water?"#003333":"#000000",e.globalAlpha=.7,e.arc(n.point.x,n.point.y,1.3,Math.PI,2*Math.PI,!1),e.closePath(),e.fill(),e.globalAlpha=1,a(n.corners).each(function(n){e.fillStyle=n.water?"#0000ff":"#009900",e.fillRect(l.toInt(n.point.x-.7),l.toInt(n.point.y-.7),l.toInt(1.5),l.toInt(1.5))})})},t.renderWatersheds=function(e,n,t){var r,i,o;a(n.edges).each(function(r){a.isNull(r.d0)||a.isNull(r.d1)||a.isNull(r.v0)||a.isNull(r.v1)||r.d0.ocean||r.d1.ocean||(i=t.watersheds[r.d0.index],o=t.watersheds[r.d1.index],i!==o&&(e.beginPath(),e.lineWidth=3.5,e.strokeStyle=u.rgba(0,0,0,.1*Math.sqrt(l.coalesce(n.corners[i].watershedSize,1)+l.coalesce(n.corners[o].watershed.watershedSize,1))),e.moveTo(r.v0.point.x,r.v0.point.y),e.lineTo(r.v1.point.x,r.v1.point.y),e.closePath(),e.stroke()))});for(r in n.edges)s.booleanFromInt(r.river)&&(e.beginPath(),e.lineWidth=1,e.strokeStyle="#6699ff",e.moveTo(r.v0.point.x,r.v0.point.y),e.lineTo(r.v1.point.x,r.v1.point.y),e.closePath(),e.stroke())},t.renderPolygons=function(e,n,t,o,a,s){e.fillStyle=u.intToHexColor(n.OCEAN),e.fillRect(0,0,l.toInt(a.SIZE.width),l.toInt(a.SIZE.height));for(var c=function(e,n,t){var i=s.path0[m.index];e.moveTo(n,t),e.lineTo(i[0].x,i[0].y),r(e,i),e.lineTo(n,t)},f=function(e,n,t){var i=s.path1[m.index];e.moveTo(n,t),e.lineTo(i[0].x,i[0].y),r(e,i),e.lineTo(n,t)},d=0;d<a.centers.length;d++)for(var p=a.centers[d],g=0;g<p.neighbors.length;g++){var v=p.neighbors[g],m=a.lookupEdgeFromCenter(p,v),y=l.coalesce(n[p.biome],0);if(null!==o&&(y=o(y,p,v,m,n)),!l.isUndefinedOrNull(s.path0[m.index])&&!l.isUndefinedOrNull(s.path1[m.index]))if(l.isUndefinedOrNull(t))e.fillStyle=u.intToHexColor(y),e.strokeStyle=e.fillStyle,e.beginPath(),c(e,p.point.x,p.point.y),f(e,p.point.x,p.point.y),e.closePath(),e.fill(),e.stroke();else{var x=m.v0,b=m.v1,_=m.midpoint,S=.5*(x[t]+b[t]);i(e,h(p.point.x,p.point.y,p[t]),h(x.point.x,x.point.y,x[t]),h(_.x,_.y,S),[n.GRADIENT_LOW,n.GRADIENT_HIGH],c,p.point.x,p.point.y),i(e,h(p.point.x,p.point.y,p[t]),h(_.x,_.y,S),h(b.point.x,b.point.y,b[t]),[n.GRADIENT_LOW,n.GRADIENT_HIGH],f,p.point.x,p.point.y)}}},t.renderBridges=function(e,n,t,r){a(n.edges).each(function(n){if(n.river>0&&n.river<4&&!n.d0.water&&!n.d1.water&&(n.d0.elevation>.05||n.d1.elevation>.05)){var i={x:-(n.v1.point.y-n.v0.point.y),y:n.v1.point.x-n.v0.point.x};f.normalize(i,.25+(a.isNull(t.road[n.index])?0:.5)+.75*Math.sqrt(n.river)),e.beginPath(),e.lineWidth=1.1,e.strokeStyle=u.intToHexColor(r.BRIDGE),e.lineCap="square",e.moveTo(n.midpoint.x-i.x,n.midpoint.y-i.y),e.lineTo(n.midpoint.x+i.x,n.midpoint.y+i.y),e.closePath(),e.stroke()}})},t.renderRoads=function(e,n,t,r){function i(e,n,t){var r={x:-(e.v1.point.y-e.v0.point.y),y:e.v1.point.x-e.v0.point.x},i=f.subtract(n,e.midpoint);return r.x*i.x+r.y*i.y<0&&(r.x=-r.x,r.y=-r.y),f.normalize(r,t),r}var o,s,c,h,d,p,g,v,m;a(n.centers).each(function(n){if(!l.isUndefinedOrNull(t.roadConnections[n.index]))if(2===t.roadConnections[n.index].length){for(m=n.borders,h=0;h<m.length;h++)if(g=m[h],t.road[g.index]>0)for(d=h+1;d<m.length;d++)v=m[d],t.road[v.index]>0&&(p=.5*Math.min(f.distanceFromOrigin(f.subtract(g.midpoint,n.point)),f.distanceFromOrigin(f.subtract(v.midpoint,n.point))),o=f.add(i(g,n.point,p),g.midpoint),s=f.add(i(v,n.point,p),v.midpoint),c=f.interpolate(o,s,.5),e.beginPath(),e.lineWidth=1.1,e.strokeStyle=u.intToHexColor(r["ROAD"+t.road[g.index]]),e.moveTo(g.midpoint.x,g.midpoint.y),e.quadraticCurveTo(o.x,o.y,c.x,c.y),e.moveTo(c.x,c.y),e.lineWidth=1.1,e.strokeStyle=u.intToHexColor(r["ROAD"+t.road[v.index]]),e.quadraticCurveTo(s.x,s.y,v.midpoint.x,v.midpoint.y),e.stroke(),e.closePath())}else a(n.borders).each(function(a){t.road[a.index]>0&&(p=.25*f.distanceFromOrigin(f.subtract(a.midpoint,n.point)),o=f.add(i(a,n.point,p),a.midpoint),e.beginPath(),e.lineWidth=1.4,e.strokeStyle=u.intToHexColor(r["ROAD"+t.road[a.index]]),e.moveTo(a.midpoint.x,a.midpoint.y),e.quadraticCurveTo(o.x,o.y,n.point.x,n.point.y),e.stroke(),e.closePath())})})},t.renderEdges=function(e,n,t,i,a,c){c=l.def(c,!0);for(var f,h=0;h<t.centers.length;h++)for(var d=t.centers[h],p=0;p<d.neighbors.length;p++){var g=d.neighbors[p];if(f=t.lookupEdgeFromCenter(d,g),!l.isUndefinedOrNull(i.path0[f.index])&&!l.isUndefinedOrNull(i.path1[f.index])){if(d.ocean!==g.ocean)e.lineWidth=2,e.strokeStyle=u.intToHexColor(n.COAST);else if(s.intFromBoolean(d.water)>0!=s.intFromBoolean(g.water)>0&&"ICE"!==d.biome&&"ICE"!==g.biome)e.lineWidth=1,e.strokeStyle=u.intToHexColor(n.LAKESHORE);else{if(d.water||g.water)continue;if(a.lava[f.index])e.lineWidth=1,e.strokeStyle=u.intToHexColor(n.LAVA);else{if(!(f.river>0&&c))continue;e.lineWidth=Math.sqrt(f.river),e.strokeStyle=u.intToHexColor(n.RIVER)}}e.beginPath(),e.moveTo(i.path0[f.index][0].x,i.path0[f.index][0].y),r(e,i.path0[f.index]),o(e,i.path1[f.index]),e.stroke(),e.closePath()}}},t.renderAllEdges=function(e,n,t,i){var a;e.lineWidth=5,e.strokeStyle=n;for(var u=0;u<t.centers.length;u++)for(var s=t.centers[u],c=0;c<s.neighbors.length;c++){var f=s.neighbors[c];a=t.lookupEdgeFromCenter(s,f),l.isUndefinedOrNull(i.path0[a.index])||l.isUndefinedOrNull(i.path1[a.index])||s.water||(e.beginPath(),e.moveTo(i.path0[a.index][0].x,i.path0[a.index][0].y),r(e,i.path0[a.index]),o(e,i.path1[a.index]),e.stroke(),e.closePath())}}},{"../as3/conversion-core":2,"../as3/matrix":3,"../as3/point-core":4,"../as3/vector-3d":6,"../janicek/core":11,"../janicek/html-color":13,lodash:1}],41:[function(e,n){"use strict";n.exports=function(){return{index:null,point:null,water:null,ocean:null,coast:null,border:null,biome:null,elevation:null,moisture:null,neighbors:null,borders:null,corners:null}}},{}],42:[function(e,n){"use strict";n.exports=function(){return{index:null,point:null,ocean:null,water:null,coast:null,border:null,elevation:null,moisture:null,touches:null,protrudes:null,adjacent:null,river:null,downslope:null,watershed:null,watershedSize:null}}},{}],43:[function(e,n){"use strict";n.exports=function(){return{index:0,d0:null,d1:null,v0:null,v1:null,midpoint:null,river:0}}},{}],44:[function(e,n,t){"use strict";var r=e("../janicek/array2d"),i=e("../janicek/core"),o=e("../as3/point-core").distanceFromOrigin,a=e("../janicek/perlin-noise"),u=e("../polygonal/pm-prng"),s=e("../janicek/pseudo-random-number-generators");t.makeRadial=function(e,n){function t(e){var t=Math.atan2(e.y,e.x),r=.5*(Math.max(Math.abs(e.x),Math.abs(e.y))+o(e)),i=.5+.4*Math.sin(s+a*t+Math.cos((a+3)*t)),u=.7-.2*Math.sin(s+a*t-Math.sin((a+2)*t));return(Math.abs(t-l)<c||Math.abs(t-l+2*Math.PI)<c||Math.abs(t-l-2*Math.PI)<c)&&(i=u=.2),i>r||r>i*n&&u>r}n=i.def(n,1.07);var r=u();r.seed=e;var a=r.nextIntRange(1,6),s=r.nextDoubleRange(0,2*Math.PI),l=r.nextDoubleRange(0,2*Math.PI),c=r.nextDoubleRange(.2,.7);return t},t.makePerlin=function(e,n){n=i.def(n,.5);var t=.1,u=.5;n=(u-t)*n+t;var s=r(a.makePerlinNoise(256,256,1,1,1,e,8));return function(e){var t=(255&s.get(i.toInt(128*(e.x+1)),i.toInt(128*(e.y+1))))/255;return t>n+n*o(e)*o(e)}},t.makeSquare=function(){return function(){return!0}},t.makeBlob=function(){return function(e){var n=o({x:e.x-.2,y:e.y/2+.2})<.05,t=o({x:e.x+.2,y:e.y/2+.2})<.05,r=o(e)<.8-.18*Math.sin(5*Math.atan2(e.y,e.x));return r&&!n&&!t}},t.makeBitmap=function(e){e=r(e);var n=e.dimensions();return function(t){var r=i.toInt((t.x+1)/2*n.x),o=i.toInt((t.y+1)/2*n.y);return e.get(r,o)}},t.makeNoise=function(e){return function(){return e=s.nextParkMiller(e),s.toBool(e)}}},{"../as3/point-core":4,"../janicek/array2d":9,"../janicek/core":11,"../janicek/perlin-noise":16,"../janicek/pseudo-random-number-generators":17,"../polygonal/pm-prng":39}],45:[function(e,n,t){"use strict";var r=e("lodash"),i=e("../as3/conversion-core");n.exports=function(){return{lava:[],createLava:function(e,n){r(e.edges).each(function(e){!i.booleanFromInt(e.river)&&!e.d0.water&&!e.d1.water&&e.d0.elevation>.8&&e.d1.elevation>.8&&e.d0.moisture<.3&&e.d1.moisture<.3&&n()<t.FRACTION_LAVA_FISSURES&&(this.lava[e.index]=!0)})}}},n.exports.FRACTION_LAVA_FISSURES=.2},{"../as3/conversion-core":2,lodash:1}],46:[function(e,n){"use strict";var t=e("lodash"),r=e("../janicek/core"),i=e("./map"),o={};o.countLands=function(e){return t(t(e).filter(function(e){return!e.water})).size()},o.tryMutateMapPointsToGetNumberLands=function(e,n,t,a,u,s,l){a=r.def(a,1e4),u=r.def(u,t),s=r.def(s,i.DEFAULT_LLOYD_ITERATIONS),l=r.def(l,i.DEFAULT_LAKE_THRESHOLD);var c=u,f=Date.now(),h=!1;do{e.go0PlacePoints(c,n),e.go1BuildGraph(),e.go2AssignElevations(l);var d=o.countLands(e.centers);d===t?h=!0:c+=t>d?1:-1}while(!h&&Date.now()-f<a);return e},n.exports=o},{"../janicek/core":11,"./map":47,lodash:1}],47:[function(e,n){"use strict";var t=e("lodash"),r=e("./graph/center"),i=e("../as3/conversion-core"),o=e("../janicek/core"),a=e("./graph/corner"),u=e("./graph/edge"),s=e("../as3/point-core"),l=e("./point-selector"),c=e("../polygonal/pm-prng"),f=e("../as3/rectangle"),h=e("../nodename/delaunay/voronoi"),d=function(e){var n={};return n.SIZE=e,n.islandShape=null,n.mapRandom=c(),n.needsMoreRandomness,n.points=[],n.centers=[],n.corners=[],n.edges=[],n.newIsland=function(e,t){n.islandShape=e,n.mapRandom.seed=t},n.go0PlacePoints=function(e,t){n.needsMoreRandomness=l.needsMoreRandomness(t),e=o.def(e,d.DEFAULT_NUMBER_OF_POINTS),n.reset(),n.points=t(e)},n.go1BuildGraph=function(){var e=h.make(n.points,null,f(0,0,n.SIZE.width,n.SIZE.height));n.buildGraph(n.points,e),n.improveCorners(),e.dispose(),e=null,n.points=null},n.go2AssignElevations=function(e){e=o.def(e,d.DEFAULT_LAKE_THRESHOLD),n.assignCornerElevations(),n.assignOceanCoastAndLand(e),n.redistributeElevations(n.landCorners(n.corners)),t(n.corners).each(function(e){(e.ocean||e.coast)&&(e.elevation=0)}),n.assignPolygonElevations()},n.go3AssignMoisture=function(e){e=o.def(e,null),n.calculateDownslopes(),n.calculateWatersheds(),n.createRivers(e),n.assignCornerMoisture(),n.redistributeMoisture(n.landCorners(n.corners)),n.assignPolygonMoisture()},n.go4DecorateMap=function(){n.assignBiomes()},n.reset=function(){null!==n.points&&n.points.splice(0,n.points.length),null!==n.edges&&(t(n.edges).each(function(e){e.d0=e.d1=null,e.v0=e.v1=null}),n.edges.splice(0,n.edges.length)),null!==n.centers&&(t(n.centers).each(function(e){e.neighbors.splice(0,e.neighbors.length),e.corners.splice(0,e.corners.length),e.borders.splice(0,e.borders.length)}),n.centers.splice(0,n.centers.length)),null!==n.corners&&(t(n.corners).each(function(e){e.adjacent.splice(0,e.adjacent.length),e.touches.splice(0,e.touches.length),e.protrudes.splice(0,e.protrudes.length),e.downslope=null,e.watershed=null}),n.corners.splice(0,n.corners.length)),null===n.points&&(n.points=[]),null===n.edges&&(n.edges=[]),null===n.centers&&(n.centers=[]),null===n.corners&&(n.corners=[])},n.improveCorners=function(){var e,r,i=[];for(t(n.corners).each(function(n){n.border?i[n.index]=n.point:(e={x:0,y:0},t(n.touches).each(function(n){e.x+=n.point.x,e.y+=n.point.y}),e.x/=n.touches.length,e.y/=n.touches.length,i[n.index]=e)}),r=0;r<n.corners.length;r++)n.corners[r].point=i[r];t(n.edges).each(function(e){null!==e.v0&&null!==e.v1&&(e.midpoint=s.interpolate(e.v0.point,e.v1.point,.5))})},n.landCorners=function(e){var n=[];return t(e).each(function(e){e.ocean||e.coast||n.push(e)}),n},n.buildGraph=function(e,i){function l(e){var t;if(null===e)return null;var r;for(r=o.toInt(e.x)-1;r<o.toInt(e.x)+2;r++)if(!o.isUndefinedOrNull(g[r]))for(var i=0;i<g[r].length;i++){t=g[r][i];var u=e.x-t.point.x,s=e.y-t.point.y;if(1e-6>u*u+s*s)return t}return r=o.toInt(e.x),o.isUndefinedOrNull(g[r])&&(g[r]=[]),t=a(),t.index=n.corners.length,n.corners.push(t),t.point=e,t.border=0===e.x||e.x===n.SIZE.width||0===e.y||e.y===n.SIZE.height,t.touches=[],t.protrudes=[],t.adjacent=[],g[r].push(t),t}function c(e,n){null!==n&&e.indexOf(n)<0&&e.push(n)}function f(e,n){null!==n&&e.indexOf(n)<0&&e.push(n)}var h,d=i.edges(),p={};t(e).each(function(e){h=r(),h.index=n.centers.length,h.point=e,h.neighbors=[],h.borders=[],h.corners=[],n.centers.push(h),p[s.hash(e)]=h}),t(n.centers).each(function(e){i.region(e.point)});var g=[];t(d).each(function(e){var t=e.delaunayLine(),r=e.voronoiEdge(),i=u();i.index=n.edges.length,i.river=0,n.edges.push(i),i.midpoint=null!==r.p0&&null!==r.p1?s.interpolate(r.p0,r.p1,.5):null,i.v0=l(r.p0),i.v1=l(r.p1),i.d0=p[s.hash(t.p0)],i.d1=p[s.hash(t.p1)],null!==i.d0&&i.d0.borders.push(i),null!==i.d1&&i.d1.borders.push(i),null!==i.v0&&i.v0.protrudes.push(i),null!==i.v1&&i.v1.protrudes.push(i),null!==i.d0&&null!==i.d1&&(f(i.d0.neighbors,i.d1),f(i.d1.neighbors,i.d0)),null!==i.v0&&null!==i.v1&&(c(i.v0.adjacent,i.v1),c(i.v1.adjacent,i.v0)),null!==i.d0&&(c(i.d0.corners,i.v0),c(i.d0.corners,i.v1)),null!==i.d1&&(c(i.d1.corners,i.v0),c(i.d1.corners,i.v1)),null!==i.v0&&(f(i.v0.touches,i.d0),f(i.v0.touches,i.d1)),null!==i.v1&&(f(i.v1.touches,i.d0),f(i.v1.touches,i.d1))})},n.assignCornerElevations=function(){var e=[];for(t(n.corners).each(function(e){e.water=!n.inside(e.point)}),t(n.corners).each(function(n){n.border?(n.elevation=0,e.push(n)):n.elevation=Number.POSITIVE_INFINITY});e.length>0;)for(var r=e.shift(),i=0;i<r.adjacent.length;i++){var o=r.adjacent[i],a=.01+r.elevation;r.water||o.water||(a+=1,n.needsMoreRandomness&&(a+=n.mapRandom.nextDouble())),a<o.elevation&&(o.elevation=a,e.push(o))}},n.redistributeElevations=function(e){var n,t,r,i=1.1;for(e.sort(function(e,n){return e.elevation>n.elevation?1:e.elevation<n.elevation?-1:e.index>n.index?1:e.index<n.index?-1:0}),n=0;n<e.length;n++)t=n/(e.length-1),r=Math.sqrt(i)-Math.sqrt(i*(1-t)),r>1&&(r=1),e[n].elevation=r},n.redistributeMoisture=function(e){var n;for(e.sort(function(e,n){return e.moisture>n.moisture?1:e.moisture<n.moisture?-1:e.index>n.index?1:e.index<n.index?-1:0}),n=0;n<e.length;n++)e[n].moisture=n/(e.length-1)},n.assignOceanCoastAndLand=function(e){var r,o,a=[];for(t(n.centers).each(function(n){o=0,t(n.corners).each(function(e){e.border&&(n.border=!0,n.ocean=!0,e.water=!0,a.push(n)),e.water&&(o+=1)}),n.water=n.ocean||o>=n.corners.length*e});a.length>0;){r=a.shift();for(var u=0;u<r.neighbors.length;u++){var s=r.neighbors[u];s.water&&!s.ocean&&(s.ocean=!0,a.push(s))}}t(n.centers).each(function(e){var n=0,r=0;t(e.neighbors).each(function(e){n+=i.intFromBoolean(e.ocean),r+=i.intFromBoolean(!e.water)}),e.coast=n>0&&r>0}),t(n.corners).each(function(e){var n=0,r=0;t(e.touches).each(function(e){n+=i.intFromBoolean(e.ocean),r+=i.intFromBoolean(!e.water)}),e.ocean=n===e.touches.length,e.coast=n>0&&r>0,e.water=e.border||r!==e.touches.length&&!e.coast})},n.assignPolygonElevations=function(){var e;t(n.centers).each(function(n){e=0,t(n.corners).each(function(n){e+=n.elevation}),n.elevation=e/n.corners.length})},n.calculateDownslopes=function(){var e;t(n.corners).each(function(n){e=n,t(n.adjacent).each(function(n){n.elevation<=e.elevation&&(e=n)}),n.downslope=e})},n.calculateWatersheds=function(){var e,r,i;t(n.corners).each(function(e){e.watershed=e,e.ocean||e.coast||(e.watershed=e.downslope)});var o,a;for(r=0;100>r;r++){for(i=!1,o=0;o<n.corners.length;o++)a=n.corners[o],a.ocean||a.coast||a.watershed.coast||(e=a.downslope.watershed,e.ocean||(a.watershed=e),i=!0);if(!i)break}for(o=0;o<n.corners.length;o++)a=n.corners[o],e=a.watershed,e.watershedSize=1+(e.watershedSize||0)},n.createRivers=function(e){e=o.coalesce(e,o.toInt((n.SIZE.width+n.SIZE.height)/4));var t,r,i;for(t=0;e>t;t++)if(r=n.corners[n.mapRandom.nextIntRange(0,n.corners.length-1)],!(r.ocean||r.elevation<.3||r.elevation>.9))for(;!r.coast&&r!==r.downslope;)i=n.lookupEdgeFromCorner(r,r.downslope),i.river=i.river+1,r.river=(r.river||0)+1,r.downslope.river=(r.downslope.river||0)+1,r=r.downslope},n.assignCornerMoisture=function(){var e,r,i=[];for(t(n.corners).each(function(e){(e.water||e.river>0)&&!e.ocean?(e.moisture=e.river>0?Math.min(3,.2*e.river):1,i.push(e)):e.moisture=0});i.length>0;){e=i.shift();for(var o=0;o<e.adjacent.length;o++){var a=e.adjacent[o];r=.9*e.moisture,r>a.moisture&&(a.moisture=r,i.push(a))}}t(n.corners).each(function(e){(e.ocean||e.coast)&&(e.moisture=1)})},n.assignPolygonMoisture=function(){var e;t(n.centers).each(function(n){e=0,t(n.corners).each(function(n){n.moisture>1&&(n.moisture=1),e+=n.moisture}),n.moisture=e/n.corners.length})},n.assignBiomes=function(){t(n.centers).each(function(e){e.biome=d.getBiome(e)})},n.lookupEdgeFromCenter=function(e,n){for(var t=0;t<e.borders.length;t++){var r=e.borders[t];if(r.d0===n||r.d1===n)return r}return null},n.lookupEdgeFromCorner=function(e,n){for(var t=0;t<e.protrudes.length;t++){var r=e.protrudes[t];if(r.v0===n||r.v1===n)return r}return null},n.inside=function(e){return n.islandShape({x:2*(e.x/n.SIZE.width-.5),y:2*(e.y/n.SIZE.height-.5)})},n.reset(),n};d.DEFAULT_LAKE_THRESHOLD=.3,d.DEFAULT_LLOYD_ITERATIONS=2,d.DEFAULT_NUMBER_OF_POINTS=1e3,d.getBiome=function(e){return e.ocean?"OCEAN":e.water?e.elevation<.1?"MARSH":e.elevation>.8?"ICE":"LAKE":e.coast?"BEACH":e.elevation>.8?e.moisture>.5?"SNOW":e.moisture>.33?"TUNDRA":e.moisture>.16?"BARE":"SCORCHED":e.elevation>.6?e.moisture>.66?"TAIGA":e.moisture>.33?"SHRUBLAND":"TEMPERATE_DESERT":e.elevation>.3?e.moisture>.83?"TEMPERATE_RAIN_FOREST":e.moisture>.5?"TEMPERATE_DECIDUOUS_FOREST":e.moisture>.16?"GRASSLAND":"TEMPERATE_DESERT":e.moisture>.66?"TROPICAL_RAIN_FOREST":e.moisture>.33?"TROPICAL_SEASONAL_FOREST":e.moisture>.16?"GRASSLAND":"SUBTROPICAL_DESERT"},n.exports=d},{"../as3/conversion-core":2,"../as3/point-core":4,"../as3/rectangle":5,"../janicek/core":11,"../nodename/delaunay/voronoi":34,"../polygonal/pm-prng":39,"./graph/center":41,"./graph/corner":42,"./graph/edge":43,"./point-selector":49,lodash:1}],48:[function(e,n){"use strict";var t=e("lodash"),r=e("../as3/conversion-core"),i=e("../janicek/core"),o=e("../as3/point-core"),a=e("../janicek/pseudo-random-number-generators");n.exports=function(){var e={};return e.path0=[],e.path1=[],e.buildNoisyEdges=function(u,s,l,c){c=i.def(c,.5);var f=a.randomGenerator(l,a.nextParkMiller);t(u.centers).each(function(a){t(a.borders).each(function(t){if(!i.isUndefinedOrNull(t.d0)&&!i.isUndefinedOrNull(t.d1)&&!i.isUndefinedOrNull(t.v0)&&!i.isUndefinedOrNull(t.v1)&&i.isUndefinedOrNull(e.path0[t.index])){var a=c,u=o.interpolate(t.v0.point,t.d0.point,a),l=o.interpolate(t.v0.point,t.d1.point,a),h=o.interpolate(t.v1.point,t.d0.point,a),d=o.interpolate(t.v1.point,t.d1.point,a),p=10;
t.d0.biome!==t.d1.biome&&(p=3),t.d0.ocean&&t.d1.ocean&&(p=100),(t.d0.coast||t.d1.coast)&&(p=1),(r.booleanFromInt(t.river)||!i.isUndefinedOrNull(s.lava[t.index]))&&(p=1),e.path0[t.index]=n.exports.buildNoisyLineSegments(f(),t.v0.point,u,t.midpoint,l,p),e.path1[t.index]=n.exports.buildNoisyLineSegments(f(),t.v1.point,d,t.midpoint,h,p)}})})},e},n.exports.buildNoisyLineSegments=function(e,n,t,r,i,u){function s(e,n,t,r){if(!(o.distanceFromOrigin(o.subtract(e,t))<u||o.distanceFromOrigin(o.subtract(n,r))<u)){var i=a.toFloatRange(l(),.2,.8),f=a.toFloatRange(l(),.2,.8),h=o.interpolate(e,r,i),d=o.interpolate(n,t,i),p=o.interpolate(e,n,f),g=o.interpolate(r,t,f),v=o.interpolate(h,d,f),m=1-a.toFloatRange(l(),-.4,.4),y=1-a.toFloatRange(l(),-.4,.4);s(e,o.interpolate(p,n,m),v,o.interpolate(h,r,y)),c.push(v),s(v,o.interpolate(d,t,m),t,o.interpolate(g,r,y))}}var l=a.randomGenerator(e,a.nextParkMiller),c=[];return c.push(n),s(n,t,r,i),c.push(r),c}},{"../as3/conversion-core":2,"../as3/point-core":4,"../janicek/core":11,"../janicek/pseudo-random-number-generators":17,lodash:1}],49:[function(e,n){"use strict";var t=e("../polygonal/pm-prng"),r=e("../as3/rectangle"),i=e("../nodename/delaunay/voronoi"),o={needsMoreRandomness:function(e){return e===o.generateSquare||e===o.generateHexagon},generateRandom:function(e,n,r){return function(i){var o=t();o.seed=r;for(var a=[],u=0;i>u;u++)a.push({x:o.nextDoubleRange(10,e-10),y:o.nextDoubleRange(10,n-10)});return a}},generateRelaxed:function(e,n,t,a){return a=a||2,function(u){for(var s=o.generateRandom(e,n,t)(u),l=0;a>l;l++){for(var c=i.make(s,null,r(0,0,e,n)),f=0;f<s.length;f++){var h=s[f],d=c.region(h);h.x=0,h.y=0;for(var p=0;p<d.length;p++){var g=d[p];h.x+=g.x,h.y+=g.y}h.x/=d.length,h.y/=d.length,d.splice(0,d.length)}c.dispose()}return s}},generateSquare:function(e,n){return function(t){for(var r=[],i=Math.sqrt(t),o=0;i>o;o++)for(var a=0;i>a;a++)r.push({x:(.5+o)/i*e,y:(.5+a)/i*n});return r}},generateHexagon:function(e,n){return function(t){for(var r=[],i=Math.sqrt(t),o=0;i>o;o++)for(var a=0;i>a;a++)r.push({x:(.5+o)/i*e,y:(.25+.5*o%2+a)/i*n});return r}}};n.exports=o},{"../as3/rectangle":5,"../nodename/delaunay/voronoi":34,"../polygonal/pm-prng":39}],50:[function(e,n){"use strict";var t=e("lodash"),r=e("../janicek/core");n.exports=function(){var e={};return e.road=[],e.roadConnections=[],e.createRoads=function(n,i){var o,a,u=[],s=[],l=[];for(t(n.centers).each(function(e){(e.coast||e.ocean)&&(l[e.index]=1,u.push(e))});u.length>0;){o=u.shift();for(var c=0;c<o.neighbors.length;c++){var f=o.neighbors[c];for(a=r.coalesce(l[o.index],0);f.elevation>i[a]&&!f.water;)a+=1;a<r.coalesce(l[f.index],999)&&(l[f.index]=a,u.push(f))}}t(n.centers).each(function(e){t(e.corners).each(function(n){s[n.index]=r.toInt(Math.min(r.coalesce(s[n.index],999),r.coalesce(l[e.index],999)))})}),t(n.centers).each(function(n){t(n.borders).each(function(i){t.isNull(i.v0)||t.isNull(i.v1)||s[i.v0.index]===s[i.v1.index]||(e.road[i.index]=r.toInt(Math.min(s[i.v0.index],s[i.v1.index])),r.isUndefinedOrNull(e.roadConnections[n.index])&&(e.roadConnections[n.index]=[]),e.roadConnections[n.index].push(i))})})},e}},{"../janicek/core":11,lodash:1}],51:[function(e,n,t){"use strict";t.displayColors={OCEAN:4473978,COAST:3355482,LAKESHORE:2250120,LAKE:3368601,RIVER:2250120,MARSH:3106406,ICE:10092543,BEACH:10522743,ROAD1:4465169,ROAD2:5583650,ROAD3:6702131,BRIDGE:6842464,LAVA:13382451,SNOW:16777215,TUNDRA:12303274,BARE:8947848,SCORCHED:5592405,TAIGA:10070647,SHRUBLAND:8952183,TEMPERATE_DESERT:13226651,TEMPERATE_RAIN_FOREST:4491349,TEMPERATE_DECIDUOUS_FOREST:6788185,GRASSLAND:8956501,SUBTROPICAL_DESERT:13810059,TROPICAL_RAIN_FOREST:3372885,TROPICAL_SEASONAL_FOREST:5609796},t.elevationGradientColors={OCEAN:34816,GRADIENT_LOW:34816,GRADIENT_HIGH:16776960}},{}],52:[function(e,n){"use strict";var t=e("lodash");n.exports=function(){var e={};return e.lowestCorner=[],e.watersheds=[],e.createWatersheds=function(n){var r;t(n.centers).each(function(n){r=null,t(n.corners).each(function(e){(null===r||e.elevation<r.elevation)&&(r=e)}),e.lowestCorner[n.index]=null===r?-1:r.index,e.watersheds[n.index]=null===r?-1:null===r.watershed?-1:r.watershed.index})},e}},{lodash:1}]},{},[7]);